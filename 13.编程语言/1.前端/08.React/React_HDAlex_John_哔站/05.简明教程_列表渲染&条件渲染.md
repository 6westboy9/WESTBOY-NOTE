# React 简明教程 - 第五节：列表渲染 & 条件渲染

本节通过一个**天气预报列表**应用，学习 React 中的列表渲染和条件渲染。

## 项目结构

```
05.列表渲染&条件渲染/
├── starter/       # 起始代码（硬编码的静态列表）
└── final/         # 最终代码（动态列表渲染）
```

---

## 1. 起始代码 (starter/main.js)

```javascript
const cities = [
  {
    name: "New York",
    country: "USA",
    forecast: [
      { date: "2024-04-03", temperature: 15, weather: "Partly cloudy" },
      { date: "2024-04-04", temperature: 17, weather: "Sunny" },
      // ...
    ],
  },
  {
    name: "London",
    country: "UK",
    forecast: [
      { date: "2024-04-03", temperature: 12, weather: "Cloudy" },
      // ...
    ],
  },
  // 更多城市...
];

function MyApp() {
  return (
    <main>
      {/* 硬编码的重复代码 - 不推荐 */}
      <section className="city">
        <h2>UK</h2>
        <h3>London</h3>
        <ul>
          <li>{new Date().toLocaleDateString()} <span>temperature: 20℃(Sunny)</span></li>
          <li>{new Date().toLocaleDateString()} <span>temperature: 19℃(Cloudy)</span></li>
          <li>{new Date().toLocaleDateString()} <span>temperature: 12℃(Rain)</span></li>
        </ul>
      </section>

      <section className="city">
        <h2>CN</h2>
        <h3>Beijing</h3>
        <p>Can't find any data</p>
      </section>
    </main>
  );
}
```

**问题**：代码重复，无法动态渲染，难以维护。

---

## 2. 最终代码 (final/main.js)

```javascript
function MyApp() {
  const cities = [
    {
      name: "New York",
      country: "USA",
      forecast: [
        { date: "2024-04-03", temperature: 15, weather: "Partly cloudy" },
        { date: "2024-04-04", temperature: 17, weather: "Sunny" },
        { date: "2024-04-05", temperature: 18, weather: "Partly cloudy" },
        { date: "2024-04-06", temperature: 20, weather: "Rain" },
        { date: "2024-04-07", temperature: 16, weather: "Thunderstorms" },
        { date: "2024-04-08", temperature: 14, weather: "Cloudy" },
        { date: "2024-04-09", temperature: 13, weather: "Partly cloudy" },
      ],
    },
    {
      name: "London",
      country: "UK",
      forecast: [
        { date: "2024-04-03", temperature: 12, weather: "Cloudy" },
        { date: "2024-04-04", temperature: 14, weather: "Rain" },
        { date: "2024-04-05", temperature: 15, weather: "Partly cloudy" },
        { date: "2024-04-06", temperature: 13, weather: "Sunny" },
        { date: "2024-04-07", temperature: 11, weather: "Cloudy" },
        { date: "2024-04-08", temperature: 10, weather: "Rain" },
        { date: "2024-04-09", temperature: 12, weather: "Partly cloudy" },
      ],
    },
    {
      name: "Tokyo",
      country: "Japan",
      forecast: [
        { date: "2024-04-03", temperature: 20, weather: "Sunny" },
        { date: "2024-04-04", temperature: 21, weather: "Partly cloudy" },
        { date: "2024-04-05", temperature: 22, weather: "Cloudy" },
        { date: "2024-04-06", temperature: 19, weather: "Rain" },
        { date: "2024-04-07", temperature: 18, weather: "Partly cloudy" },
        { date: "2024-04-08", temperature: 17, weather: "Sunny" },
        { date: "2024-04-09", temperature: 20, weather: "Cloudy" },
      ],
    },
    {
      name: "Sydney",
      country: "Australia",
      forecast: [],  // 空数组 - 用于测试条件渲染
    },
    {
      name: "Beijing",
      country: "China",
      // 没有 forecast 属性 - 用于测试条件渲染
    },
  ];

  return (
    <main>
      {/* 列表渲染：遍历 cities 数组 */}
      {cities.map((city) => (
        <section className="city">
          <h2>{city.country}</h2>
          <h3>{city.name}</h3>

          {/* 条件渲染：根据是否有数据显示不同内容 */}
          {city.forecast && city.forecast.length > 0 ? (
            <ul>
              {/* 嵌套列表渲染：遍历每个城市的预报数据 */}
              {city.forecast.map((day, index) => (
                <li key={index}>
                  {day.date}
                  <span>
                    temperature: {day.temperature}℃({day.weather})
                  </span>
                </li>
              ))}
            </ul>
          ) : (
            <div>No Data</div>
          )}
        </section>
      ))}
    </main>
  );
}

const appEl = document.querySelector("#app");
const root = ReactDOM.createRoot(appEl);
root.render(<MyApp />);
```

---

## 3. 核心概念解析

### 3.1 列表渲染 - map() 方法

React 中使用 JavaScript 的 `map()` 方法来渲染列表。

```javascript
{cities.map((city) => (
  <section key={city.id}>
    <h2>{city.name}</h2>
  </section>
))}
```

| 要点 | 说明 |
|---|---|
| 使用 `{}` | 在 JSX 中嵌入 JavaScript 表达式 |
| 使用 `map()` | 返回新数组，每个元素返回一个 JSX 元素 |
| 返回单元素 | `map()` 的回调函数必须返回一个 JSX 元素 |
| **重要：key 属性** | 帮助 React 识别哪些元素改变了 |

### 3.2 key 属性的作用

```javascript
// ❌ 错误：缺少 key
{items.map(item => <div>{item.name}</div>)}

// ✅ 正确：添加 key
{items.map(item => <div key={item.id}>{item.name}</div>)}

// ⚠️ 不推荐：使用 index 作为 key（仅当列表静态且有序时）
{items.map((item, index) => <div key={index}>{item.name}</div>)}
```

**key 的作用**：

```
┌─────────────────────────────────────────────────────────┐
│                    没有 key 的情况                        │
├─────────────────────────────────────────────────────────┤
│  React 无法识别元素变化，可能                             │
│  - 错误地复用 DOM 元素                                    │
│  - 导致状态混乱                                           │
│  - 性能问题                                               │
└─────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────┐
│                    有 key 的情况                          │
├─────────────────────────────────────────────────────────┤
│  React 可以精确识别每个元素                               │
│  - 正确复用 DOM 元素                                      │
│  - 高效更新                                              │
│  - 避免状态混乱                                           │
└─────────────────────────────────────────────────────────┘
```

### 3.3 条件渲染

React 中的条件渲染有多种方式：

#### 方式一：三元运算符

```javascript
{condition ? <ComponentA /> : <ComponentB />}
```

#### 方式二：逻辑与 (&&)

```javascript
{condition && <Component />}
```

#### 方式三：立即执行函数

```javascript
{(() => {
  if (condition) return <ComponentA />;
  return <ComponentB />;
})()}
```

**本例中使用**：三元运算符处理有无数据的情况

```javascript
{city.forecast && city.forecast.length > 0 ? (
  <ul>{/* 显示预报列表 */}</ul>
) : (
  <div>No Data</div>
)}
```

### 3.4 嵌套列表渲染

```
┌─────────────────────────────────────────────────────────┐
│                        外层 map                          │
│  cities.map((city) => ...)                              │
│  ┌────────────────────────────────────────────────────┐ │
│  │  城市 1: New York                                  │ │
│  │  ┌──────────────────────────────────────────────┐  │ │
│  │  │         内层 map                              │  │ │
│  │  │  forecast.map((day) => ...)                   │  │ │
│  │  │  • 2024-04-03: 15℃ (Partly cloudy)           │  │ │
│  │  │  • 2024-04-04: 17℃ (Sunny)                   │  │ │
│  │  │  • ...                                        │  │ │
│  │  └──────────────────────────────────────────────┘  │ │
│  └────────────────────────────────────────────────────┘ │
│  ┌────────────────────────────────────────────────────┐ │
│  │  城市 2: London                                    │ │
│  │  ┌──────────────────────────────────────────────┐  │ │
│  │  │         内层 map                              │  │ │
│  │  │  forecast.map((day) => ...)                   │  │ │
│  │  │  • 2024-04-03: 12℃ (Cloudy)                   │  │ │
│  │  │  • ...                                        │  │ │
│  │  └──────────────────────────────────────────────┘  │ │
│  └────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
```

---

## 4. 条件渲染的边界情况处理

本例中的数据包含了多种边界情况：

| 城市 | forecast 数据 | 显示结果 |
|---|---|---|
| New York | 有数据（7 天） | 显示预报列表 |
| Sydney | 空数组 `[]` | 显示 "No Data" |
| Beijing | `undefined`（无此属性） | 显示 "No Data" |

**处理条件**：

```javascript
// 同时检查 forecast 存在且长度大于 0
{city.forecast && city.forecast.length > 0 ? (
  <ul>{/* 列表 */}</ul>
) : (
  <div>No Data</div>
)}
```

---

## 5. 样式文件 (style.css)

```css
.city {
  text-align: center;
  border: 1px solid orangered;
  border-radius: 4px;
  margin: 8px auto;
}

li {
  list-style: none;  /* 去除列表默认样式 */
}

h2 {
  color: blueviolet;
}

h3 {
  color: brown;
}
```

---

## 6. 小结

本节学习了：

1. ✅ **列表渲染** - 使用 `map()` 方法遍历数组
2. ✅ **key 属性** - 帮助 React 高效更新列表
3. ✅ **条件渲染** - 三元运算符、逻辑与等多种方式
4. ✅ **嵌套列表** - 多层 `map()` 实现嵌套数据结构
5. ✅ **边界处理** - 处理空数组、undefined 等情况

> **核心原则**：在 React 中，一切渲染都是 JavaScript 表达式。列表渲染用 `map()`，条件渲染用三元运算符或逻辑与。
