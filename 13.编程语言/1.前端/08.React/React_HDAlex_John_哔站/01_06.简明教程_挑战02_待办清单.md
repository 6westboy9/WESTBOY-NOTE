# React 简明教程 - 第六节：挑战 02 - 待办清单

本节通过一个 **待办清单（Todo List）** 应用，综合运用列表渲染、状态管理和数组操作。

## 项目结构

```
06.挑战02-待办清单/
├── starter/       # 起始代码（静态列表）
└── final/         # 最终代码（完整功能）
```

---

## 1. 挑战起始代码 (starter/main.js)

```javascript
/*
  任务：
  1. 实现添加和删除待办事项
  2. 实现完成待办事项（已完成的项目应该移到底部）
*/

function MyApp() {
  return (
    <main>
      <h1>React Todo List</h1>
      <input type="text" placeholder="Add item into as todo" />
      <button>Add</button>
      <ul>
        <li className="deleted">
          <input type="checkbox" />
          Learn React <button>delete</button>
        </li>
        <li>
          Learn Angular <button>delete</button>
        </li>
        <li>
          Learn Vue <button>delete</button>
        </li>
        <li>
          Learn Svelte <button>delete</button>
        </li>
      </ul>
    </main>
  );
}

const appEl = document.querySelector("#app");
const root = ReactDOM.createRoot(appEl);
root.render(<MyApp />);
```

---

## 2. 挑战任务清单

| # | 任务 | 涉及知识点 |
|---|---|---|
| 1 | 定义状态结构 | useState、对象数组 |
| 2 | 实现添加待办事项 | 数组展开运算符、排序 |
| 3 | 实现删除待办事项 | filter 方法 |
| 4 | 实现完成状态切换 | map 方法、对象展开 |
| 5 | 列表自动排序 | 自定义排序函数 |

### 目标效果

- ✅ 输入内容并点击 Add → 添加新待办事项
- ✅ 点击 delete → 删除该事项
- ✅ 勾选复选框 → 事项标记为完成，移到底部
- ✅ 取消勾选 → 事项恢复未完成状态，移回顶部

---

## 3. 数据结构设计

```javascript
// 每个待办事项的数据结构
{
  id: 1,                      // 唯一标识
  item: "Learn React",        // 待办内容
  isCompleted: false,         // 是否完成
}

// 初始状态
const [todoList, setTodoList] = React.useState([
  {
    id: 1,
    item: "Learn React",
    isCompleted: false,
  },
  {
    id: 2,
    item: "Learn Svelte",
    isCompleted: true,
  },
]);
```

---

## 4. 核心功能实现

### 4.1 添加待办事项

```javascript
function handleAddTodo() {
  // 验证输入
  if (!currentTodoItem.length) {
    alert("Please enter a todo item");
    return;
  }

  // 创建新数组（不直接修改原数组）
  const addedList = [
    ...todoList,                        // 展开原数组
    {
      id: Math.random() + Date.now(),   // 生成唯一 ID
      item: currentTodoItem,            // 新事项内容
      isCompleted: false,               // 新事项默认未完成
    },
  ];

  // 排序（未完成在前，已完成在后）
  addedList.sort(sortTodo);

  // 更新状态
  setTodoList(addedList);

  // 清空输入框
  setCurrentTodoItem("");
}
```

### 4.2 删除待办事项

```javascript
function handleDeleteTodo(id) {
  // 使用 filter 过滤掉要删除的项
  const deletedTodoList = todoList.filter((todo) => todo.id !== id);
  deletedTodoList.sort(sortTodo);
  setTodoList(deletedTodoList);
}
```

### 4.3 切换完成状态

```javascript
function handleToggleTodo(id) {
  // 使用 map 更新指定项的 isCompleted
  const toggledTodoList = todoList.map((todo) => {
    if (todo.id === id) {
      return {
        ...todo,                      // 保留原有属性
        isCompleted: !todo.isCompleted, // 切换状态
      };
    }
    return todo;  // 其他项保持不变
  });

  toggledTodoList.sort(sortTodo);
  setTodoList(toggledTodoList);
}
```

### 4.4 排序函数

```javascript
const sortTodo = (o1, o2) => {
  // 首先按完成状态排序：未完成在前，已完成在后
  if (o1.isCompleted !== o2.isCompleted) {
    return o1.isCompleted ? 1 : -1;
  }

  // 相同状态下按 id 排序（保持创建顺序）
  return o1.id - o2.id;
};
```

**排序逻辑图示**：

```
┌─────────────────────────────────────────────────────────┐
│                      排序前                              │
├─────────────────────────────────────────────────────────┤
│  [1] Learn React      (未完成)                          │
│  [2] Learn Svelte     (已完成) ← 排到后面               │
│  [3] Learn Vue        (未完成)                          │
└─────────────────────────────────────────────────────────┘
                          ↓ sortTodo()
┌─────────────────────────────────────────────────────────┐
│                      排序后                              │
├─────────────────────────────────────────────────────────┤
│  [1] Learn React      (未完成) ← 优先                   │
│  [3] Learn Vue        (未完成)                          │
│  [2] Learn Svelte     (已完成) ← 放后面                 │
└─────────────────────────────────────────────────────────┘
```

---

## 5. 完整参考答案 (final/main.js)

```javascript
function MyApp() {
  // 输入框的状态
  const [currentTodoItem, setCurrentTodoItem] = React.useState("");

  // 待办列表的状态
  const [todoList, setTodoList] = React.useState([
    {
      id: 1,
      item: "Learn React",
      isCompleted: false,
    },
    {
      id: 2,
      item: "Learn Svelte",
      isCompleted: true,
    },
  ]);

  // 排序函数
  const sortTodo = (o1, o2) => {
    if (o1.isCompleted !== o2.isCompleted) {
      return o1.isCompleted ? 1 : -1;
    }
    return o1.id - o2.id;
  };

  // 添加待办事项
  function handleAddTodo() {
    if (!currentTodoItem.length) {
      alert("Please enter a todo item");
      return;
    }

    const addedList = [
      ...todoList,
      {
        id: Math.random() + Date.now(),
        item: currentTodoItem,
        isCompleted: false,
      },
    ];
    addedList.sort(sortTodo);

    setTodoList(addedList);
    setCurrentTodoItem("");
  }

  // 删除待办事项
  function handleDeleteTodo(id) {
    const deletedTodoList = todoList.filter((todo) => todo.id !== id);
    deletedTodoList.sort(sortTodo);
    setTodoList(deletedTodoList);
  }

  // 切换完成状态
  function handleToggleTodo(id) {
    const toggledTodoList = todoList.map((todo) => {
      if (todo.id === id) {
        return {
          ...todo,
          isCompleted: !todo.isCompleted,
        };
      }
      return todo;
    });

    toggledTodoList.sort(sortTodo);
    setTodoList(toggledTodoList);
  }

  return (
    <main>
      <h1>React Todo List</h1>
      <input
        type="text"
        placeholder="Add item into as todo"
        value={currentTodoItem}
        onChange={(event) => setCurrentTodoItem(event.target.value)}
      />
      <button onClick={handleAddTodo}>Add</button>
      <ul>
        {todoList.map((todo) => (
          <li
            className={todo.isCompleted ? "deleted" : ""}
            key={todo.id}
          >
            <input
              type="checkbox"
              defaultChecked={todo.isCompleted}
              onClick={() => handleToggleTodo(todo.id)}
            />
            {todo.item}
            <button onClick={() => handleDeleteTodo(todo.id)}>
              delete
            </button>
          </li>
        ))}
      </ul>
    </main>
  );
}

const appEl = document.querySelector("#app");
const root = ReactDOM.createRoot(appEl);
root.render(<MyApp />);
```

---

## 6. 样式文件 (style.css)

```css
main {
  text-align: center;
}

li {
  list-style: none;
}

.deleted {
  text-decoration: line-through;  /* 已完成事项显示删除线 */
}
```

---

## 7. 数组方法总结

| 方法 | 用途 | 返回值 | 是否修改原数组 |
|---|---|---|---|
| `map()` | 遍历并转换每个元素 | 新数组 | ❌ 否 |
| `filter()` | 过滤符合条件的元素 | 新数组 | ❌ 否 |
| `sort()` | 对数组进行排序 | 排序后的数组 | ✅ 是（需要小心） |
| `push()` | 在数组末尾添加元素 | 新长度 | ✅ 是 |
| `[...arr]` | 展开运算符复制数组 | 新数组 | ❌ 否 |

**React 中的数组操作原则**：

```javascript
// ❌ 错误：直接修改状态
todoList.push(newItem);

// ✅ 正确：创建新数组
const newList = [...todoList, newItem];
setTodoList(newList);

// ❌ 危险：sort 会修改原数组
todoList.sort(sortTodo);
setTodoList(todoList);

// ✅ 安全：先复制再排序
const sortedList = [...todoList].sort(sortTodo);
setTodoList(sortedList);
```

---

## 8. 小结

本节挑战综合运用了：

1. ✅ **列表渲染** - 使用 `map()` 渲染待办列表
2. ✅ **状态管理** - 输入框状态和列表状态
3. ✅ **数组操作** - `map`、`filter`、展开运算符
4. ✅ **数组排序** - 自定义排序函数
5. ✅ **事件处理** - 添加、删除、切换状态
6. ✅ **条件渲染** - `isCompleted` 控制 `deleted` 类名

> **核心原则**：React 中的状态更新应该创建新对象/新数组，而不是直接修改原有数据。
