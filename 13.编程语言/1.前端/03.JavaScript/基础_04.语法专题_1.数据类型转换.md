
# 强制转换

强制转换主要指使用Number、String和Boolean三个函数，手动将各种类型的值，分别转换成数字、字符串或者布尔值。
## 1.Number函数

使用Number函数，可以将任意类型的值转化成数值。

下面分成两种情况讨论，一种是参数是原始类型的值，另一种是参数是对象。

### 原始类型值

原始类型值的转换规则如下：

| 原始类型      | 转换                                                   |
| --------- | ---------------------------------------------------- |
| 数值        | 还是原来的值                                               |
| 字符串       | 1.如果可以被解析为数值，则转换为相应的数值；2.如果不可以被解析为数值，返回NaN；3.空字符串转为0 |
| 布尔        | true → 1，false → 0                                   |
| Undefined | NaN                                                  |
| Null      | 0                                                    |

```js
// 数值：转换后还是原来的值
Number(324) // 324

// 字符串：如果可以被解析为数值，则转换为相应的数值
Number('324') // 324

// 字符串：如果不可以被解析为数值，返回NaN
Number('324abc') // NaN

// 空字符串转为0
Number('') // 0

// 布尔值：true 转成 1，false 转成 0
Number(true) // 1
Number(false) // 0

// undefined：转成 NaN
Number(undefined) // NaN

// null：转成0
Number(null) // 0
```

>Number与parseInt方法

```js
var a = "123abc";
var b = Number(a);
console.log(a, b);		// 123abc NaN

var a = "123abc";
var b = parseInt(a);
console.log(a, b);		// 123abc 123（不会保留数字）

var a = "12.45";
var b = parseInt(a);	// 如果使用Number(a)时，结果为12.45，会保留小数
var c = parseFloat(a);  // 当然可以使用parseFloat(a)最终会保留小数
console.log(a, b, c);   // 12.45 12 12.45
```

### 对象

简单的规则是，Number方法的参数是对象时，将返回NaN，除非是包含单个数值的数组。

```js
Number({a: 1})    // NaN
Number([1, 2, 3]) // NaN
Number([5])       // 5
```

之所以会这样，是因为Number背后的转换规则比较复杂。

* 第一步，调用对象自身的valueOf方法。如果返回原始类型的值，则直接对该值使用Number函数，不再进行后续步骤。
* 第二步，如果valueOf方法返回的还是对象，则改为调用对象自身的toString方法。如果toString方法返回原始类型的值，则对该值使用Number函数，不再进行后续步骤。
* 第三步，如果toString方法返回的是对象，就报错。

请看下面的例子。

```js
var obj = {x: 1};
Number(obj) // NaN

// 等同于
if (typeof obj.valueOf() === 'object') {
  Number(obj.toString());
} else {
  Number(obj.valueOf());
}
```

上面代码中，Number函数将obj对象转为数值。背后发生了一连串的操作，首先调用obj.valueOf方法, 结果返回对象本身。于是，继续调用obj.toString方法，这时返回字符串`[object Object]`，对这个字符串使用Number函数，得到NaN。

<font color="#c0504d">默认情况下，对象的valueOf方法返回对象本身</font>，所以一般总是会调用toString方法，而toString方法返回对象的类型字符串（比如`[object Object]`）。所以，会有下面的结果。

```js
Number({}) // NaN
```

如果toString方法返回的不是原始类型的值，结果就会报错。

```js
var obj = {
  valueOf: function () {
    return {};
  },
  toString: function () {
    return {};
  }
};

Number(obj)
// TypeError: Cannot convert object to primitive value
```

上面代码的valueOf和toString方法，返回的都是对象，所以转成数值时会报错。

从上例还可以看到，valueOf和toString方法，都是可以自定义的。

```js
Number({
  valueOf: function () {
    return 2;
  }
})
// 2

Number({
  toString: function () {
    return 3;
  }
})
// 3

Number({
  valueOf: function () {
    return 2;
  },
  toString: function () {
    return 3;
  }
})
// 2
```

上面代码对三个对象使用Number函数。第一个对象返回valueOf方法的值，第二个对象返回toString方法的值，<font color="#c0504d">第三个对象表示valueOf方法先于toString方法执行</font>。

## 2.String函数


### 原始类型值


### 对象


## 3.Boolean函数


# 自动转换