* [异步原理和事件循环图文详解](https://blog.csdn.net/Victor2code/article/details/106985959)
* [JavaScript 事件循环及异步原理（完全指北）](https://juejin.cn/post/6844903692752142343#heading-5)

# 函数调用栈与任务队列

## 函数调用栈

## 任务队列

任务队列又分为macro-task（宏任务）与micro-task（微任务），在最新标准中，它们被分别称为task与jobs。

- <font color="#c0504d">宏任务</font>大概包括：
	- `script(整体代码)`
	- `setTimeout`
	- `setInterval`
	- `setImmediate（NodeJs）`
	- `I/O`
	- `UI rendering`
- <font color="#c0504d">微任务</font>大概包括：
	- `process.nextTick（NodeJs）`
	- `Promise`
	- `Object.observe(已废弃)`
	- `MutationObserver(html5新特性)`

来自不同任务源的任务会进入到不同的任务队列。其中`setTimeout`与`setInterval`是同源的。

>事件循环决定了代码的执行顺序，从全局上下文进入函数调用栈开始，直到调用栈清空，然后执行所有的微任务，当所有的微任务执行完毕之后，再执行宏任务，其中一个宏任务的任务队列执行完毕，再次执行所有的微任务，一直循环直至执行完毕。

```js
setTimeout(() => {
    console.log(4)
}, 0);

new Promise((resolve) => {
    console.log("promise start");
    for (var i = 0; i < 9; i++) {
        console.log("promise:" + i);
        i === 5 && resolve();
    }
    console.log("promise end");
}).then(() => {
    console.log(5);
});

console.log(3);
```

输出结果：

```
promise start
promise:0
promise:1
promise:2
promise:3
promise:4
promise:5
promise:6
promise:7
promise:8
promise end
3
5
4
```

