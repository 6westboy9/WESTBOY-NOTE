# 引入


```yaml
spring:
  datasource:	
	driver-class-name: org.apache.shardingsphere.driver.ShardingSphereDriver
	# 项目环境时
	jdbc-url: jdbc:shardingsphere:classpath:sharding.yml
	# 配置文件与当前项目jar文件所处同一目录下时
	# jdbc-url: jdbc:shardingsphere:absolutepath:./sharding.yml
```

```yaml
dataSources:  
  ds_0:  
    dataSourceClassName: com.zaxxer.hikari.HikariDataSource  
    driverClassName: com.mysql.cj.jdbc.Driver  
    jdbcUrl: jdbc:mysql://10.2.3.157:3306/windranger_emr?characterEncoding=utf8&serverTimezone=GMT%2B8&allowMultiQueries=true  
    username: user  
    password: Lachesis-mh_1024  
    connectionTimeoutMilliseconds: 30000  
    idleTimeoutMilliseconds: 60000  
    maxLifetimeMilliseconds: 1800000  
    maxPoolSize: 50  
    minPoolSize: 20  
  
rules:  
  - !SINGLE  
    tables:  
      - ds_0.*  
    defaultDataSource: ds_0  
  - !SHARDING  
    bindingTables:  
      - pat_inhos_order_out,pat_inhos_order_group_out  
    tables:  
      pat_inhos_order_out:  
        actualDataNodes: <INTERVAL>P=ds_0.pat_inhos_order_out_;SP=yyyyMM;DIA=1;DIU=Months;DL=202201;DU=202412  
        tableStrategy:  
          standard:  
            shardingColumn: out_date  
            shardingAlgorithmName: out_date_interval  
      pat_inhos_order_group_out:  
        actualDataNodes: <INTERVAL>P=ds_0.pat_inhos_order_group_out_;SP=yyyyMM;DIA=1;DIU=Months;DL=202201;DU=202412  
        tableStrategy:  
          standard:  
            shardingColumn: out_date  
            shardingAlgorithmName: out_date_interval  
    shardingAlgorithms:  
      out_date_interval:  
        type: INTERVAL  
        props:  
          datetime-pattern: 'yyyy-MM-dd HH:mm:ss'  
          datetime-lower: '2022-01-01 00:00:00'  
          datetime-upper: '2024-12-31 23:59:59'  
          sharding-suffix-pattern: 'yyyyMM'  
          datetime-interval-amount: 1  
          datetime-interval-unit: MONTHS  
props:  
  # 是否开启SQL打印，默认关闭  
  sql-show: false
```

引入ShardingSphere-JDBC后数据库连接池变化，发现控制台打印了几个数据库连接池信息：

```log
2024-01-26 13:11:38.912  INFO 26340 --- [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2024-01-26 13:11:40.154  INFO 26340 --- [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-2 - Starting...
2024-01-26 13:11:40.516  INFO 26340 --- [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-2 - Start completed.
2024-01-26 13:11:40.728  INFO 26340 --- [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-3 - Starting...
2024-01-26 13:11:40.942  INFO 26340 --- [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-3 - Start completed.
2024-01-26 13:11:58.208  INFO 26340 --- [           main] com.zaxxer.hikari.pool.PoolBase - HikariPool-1 - Driver does not support get/set network timeout for connections. (getNetworkTimeout)
2024-01-26 13:11:58.210  INFO 26340 --- [           main] com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
```

>特别说明：可以看到HikariPool-1的初始化是比较慢的~

通过Arthas工具可以查看：

```sh
[arthas@37896]$ vmtool --action getInstances --className com.zaxxer.hikari.HikariDataSource --express 'instances'
riDataSource --express 'instances'ssName com.zaxxer.hikari.Hika
@HikariDataSource[][
    @HikariDataSource[HikariDataSource (HikariPool-3)],  # 
    @HikariDataSource[HikariDataSource (HikariPool-1)],
    @HikariDataSource[HikariDataSource (HikariPool-2)],
]
```

查看数据库连接池详情：

```bash
# 查看[HikariPool-1]信息
[arthas@37896]$ vmtool --action getInstances --className com.zaxxer.hikari.HikariDataSource --express 'instances[1]'
riDataSource --express 'instances[1]'ame com.zaxxer.hikari.Hika
@HikariDataSource[
    username=null,
    password=null,
    driverClassName=@String[org.apache.shardingsphere.driver.ShardingSphereDriver],
    jdbcUrl=@String[jdbc:shardingsphere:classpath:sharding.yaml],
    poolName=@String[HikariPool-1],
	# 省略了部分不重要的信息...
]

# 查看[HikariPool-2]信息
[arthas@37896]$ vmtool --action getInstances --className com.zaxxer.hikari.HikariDataSource --express 'instances[2]'
riDataSource --express 'instances[2]'ame com.zaxxer.hikari.Hika
@HikariDataSource[
    username=@String[sa],
    password=@String[],
    driverClassName=@String[org.h2.Driver],
    jdbcUrl=@String[jdbc:h2:mem:config;DB_CLOSE_DELAY=0;DATABASE_TO_UPPER=false;MODE=MYSQL],
    poolName=@String[HikariPool-2],
	# 省略了部分不重要的信息...
]

# 查看[HikariPool-3]信息
[arthas@37896]$ vmtool --action getInstances --className com.zaxxer.hikari.HikariDataSource --express 'instances[0]'
riDataSource --express 'instances[0]'ame com.zaxxer.hikari.Hika
@HikariDataSource[
    username=@String[user],
    password=@String[Lachesis-mh_1024],
    initializationFailTimeout=@Long[1],
    jdbcUrl=@String[jdbc:mysql://10.2.43.101:3306/test?characterEncoding=utf8&allowMultiQueries=true&serverTimezone=GMT%2B8],
    poolName=@String[HikariPool-3],
    # 省略了部分不重要的信息...
]

# [HikariPool-1] SpringBoot项目整合ShardingSphere是DataSource的配置，初始化最慢！！！初始化最慢！！！初始化最慢！！！
# [HikariPool-3] ShardingSphere所管理的ds
# [HikariPool-3] ShardingSphere自带元数据管理存储组件（默认h2）可以配置为MySQL或者ZK
```

# DataSource对象创建过程

原始配置：

```yaml
dataSourceClassName: com.zaxxer.hikari.HikariDataSource  
driverClassName: com.mysql.cj.jdbc.Driver  
jdbcUrl: jdbc:mysql://10.2.3.157:3306/windranger_emr?characterEncoding=utf8&serverTimezone=GMT%2B8&allowMultiQueries=true  
username: user  
password: Lachesis-mh_1024  
connectionTimeoutMilliseconds: 30000  
idleTimeoutMilliseconds: 60000  
maxLifetimeMilliseconds: 1800000  
maxPoolSize: 50  
minPoolSize: 20  
poolName: sharding_emr_ds0
```

`org.apache.shardingsphere.infra.datasource.pool.hikari.metadata.HikariDataSourcePoolMetaData`

```java
public final class HikariDataSourcePoolMetaData implements DataSourcePoolMetaData {  

    private static final Map<String, Object> DEFAULT_PROPS = new HashMap(6, 1.0F);  
    private static final Map<String, Object> SKIPPED_PROPS = new HashMap(2, 1.0F);  
    private static final Map<String, String> PROP_SYNONYMS = new HashMap(6, 1.0F);  
    private static final Collection<String> TRANSIENT_FIELD_NAMES = new LinkedList();  
  
    public HikariDataSourcePoolMetaData() {  
    }  
  
    private static void buildDefaultProperties() {  
        DEFAULT_PROPS.put("connectionTimeout", 30000L);  
        DEFAULT_PROPS.put("idleTimeout", 60000L);  
        DEFAULT_PROPS.put("maxLifetime", 2100000L);  
        DEFAULT_PROPS.put("maximumPoolSize", 50);  
        DEFAULT_PROPS.put("minimumIdle", 1);  
        DEFAULT_PROPS.put("readOnly", false);  
        DEFAULT_PROPS.put("keepaliveTime", 0);  
    }  
  
    private static void buildInvalidProperties() {  
        SKIPPED_PROPS.put("minimumIdle", -1);  
        SKIPPED_PROPS.put("maximumPoolSize", -1);  
    }  
  
    private static void buildPropertySynonyms() {  
        // 前者相当于ShardingSphere定义的属性名
        // 后者为不同数据库连接池实现类中对应的属性名
        PROP_SYNONYMS.put("url", "jdbcUrl");  
        PROP_SYNONYMS.put("connectionTimeoutMilliseconds", "connectionTimeout");  
        PROP_SYNONYMS.put("idleTimeoutMilliseconds", "idleTimeout");  
        PROP_SYNONYMS.put("maxLifetimeMilliseconds", "maxLifetime");  
        PROP_SYNONYMS.put("maxPoolSize", "maximumPoolSize");  
        PROP_SYNONYMS.put("minPoolSize", "minimumIdle");  
    }
    
	private static void buildTransientFieldNames() {  
	    TRANSIENT_FIELD_NAMES.add("running");  
	    TRANSIENT_FIELD_NAMES.add("poolName");  
	    TRANSIENT_FIELD_NAMES.add("closed");  
	}

	// 省略部分内容...
  
    static {  
        buildDefaultProperties();  
        buildInvalidProperties();  
        buildPropertySynonyms();  
        buildTransientFieldNames();  
    }  
}
```

## 1.DataSourcePoolProperties初始化

```java
public final class DataSourcePoolProperties {  
    private final String poolClassName;  // 使用HikariCP连接池时，对应的类名：com.zaxxer.hikari.HikariDataSource
    private final ConnectionPropertySynonyms connectionPropertySynonyms;  
    private final PoolPropertySynonyms poolPropertySynonyms;  
    private final CustomDataSourcePoolProperties customProperties;
    
	// ...
}
```

接下来看下在创建DataSourcePoolProperties对象时内部逻辑，主要拆分为三个属性来看。
### 1.ConnectionPropertySynonyms

```java
// props
// propertySynonyms: 在使用HikariCP数据库连接池时，对应org.apache.shardingsphere.infra.datasource.pool.hikari.metadata.HikariDataSourcePoolMetaData#PROP_SYNONYMS属性
new ConnectionPropertySynonyms(props, propertySynonyms)
```

标准与本地映射

```java
STANDARD_PROPERTY_KEYS // org.apache.shardingsphere.infra.datasource.pool.props.domain.synonym.ConnectionPropertySynonyms
	STANDARD_PROPERTY_KEYS.add("dataSourceClassName");  
	STANDARD_PROPERTY_KEYS.add("url");  
	STANDARD_PROPERTY_KEYS.add("username");  
	STANDARD_PROPERTY_KEYS.add("password");
PROP_SYNONYMS // org.apache.shardingsphere.infra.datasource.pool.hikari.metadata.HikariDataSourcePoolMetaData
	PROP_SYNONYMS.put("url", "jdbcUrl");  
	PROP_SYNONYMS.put("connectionTimeoutMilliseconds", "connectionTimeout");  
	PROP_SYNONYMS.put("idleTimeoutMilliseconds", "idleTimeout");  
	PROP_SYNONYMS.put("maxLifetimeMilliseconds", "maxLifetime");  
	PROP_SYNONYMS.put("maxPoolSize", "maximumPoolSize");  
	PROP_SYNONYMS.put("minPoolSize", "minimumIdle");
```

<font color="#ffc000">标准属性</font>

```java
url --> jdbcUrl // 通过PROP_SYNONYMS映射关系将STANDARD_PROPERTY_KEYS中url替换为jdbcUrl
username
password
```

最终从props中获取以上三个属性，复制给`standardProperties`对象，`standardProperties`对象信息如下：

```yml
# 注意实际获取的时配置文件中jdbcUrl的属性值，通过HikariDataSourcePoolMetaData做了个映射关系而已
url: jdbc:mysql://10.2.3.157:3306/windranger_emr?characterEncoding=utf8&serverTimezone=GMT%2B8&allowMultiQueries=true  
username: user
password: Lachesis-mh_1024
```

<font color="#ffc000">本地属性</font>

其实本质：就是将标准属性本地化，这里的本地化意思就是Hikari化。

>个人理解，标准属性相当于数据库连接池的共有属性，但是在不同数据库连接池中，可能存在相同属性，但是名称不一样的情况，最终都要转换成各个数据库连接池所能识别的属性，正所谓本地化！


```yaml
# 将存在交集的替换对应的key，标准属性在本地属性中不存在的，直接拿来就行
jdbcUrl: jdbc:mysql://10.2.3.157:3306/windranger_emr?characterEncoding=utf8&serverTimezone=GMT%2B8&allowMultiQueries=true  
username: user
password: Lachesis-mh_1024
```

最终生成对象如下：

![[Pasted image 20240314162550.png|1000]]

### 2.PoolPropertySynonyms

```java
// props
// propertySynonyms: 在使用HikariCP数据库连接池时，对应org.apache.shardingsphere.infra.datasource.pool.hikari.metadata.HikariDataSourcePoolMetaData#PROP_SYNONYMS属性
new PoolPropertySynonyms(props, propertySynonyms)
```

标准与本地映射

```java
STANDARD_PROPERTY_KEYS // org.apache.shardingsphere.infra.datasource.pool.props.domain.synonym.PoolPropertySynonyms
	STANDARD_PROPERTY_KEYS.add("connectionTimeoutMilliseconds");  
	STANDARD_PROPERTY_KEYS.add("idleTimeoutMilliseconds");  
	STANDARD_PROPERTY_KEYS.add("maxLifetimeMilliseconds");  
	STANDARD_PROPERTY_KEYS.add("maxPoolSize");  
	STANDARD_PROPERTY_KEYS.add("minPoolSize");  
	STANDARD_PROPERTY_KEYS.add("readOnly");
PROP_SYNONYMS // org.apache.shardingsphere.infra.datasource.pool.hikari.metadata.HikariDataSourcePoolMetaData
	PROP_SYNONYMS.put("url", "jdbcUrl");  
	PROP_SYNONYMS.put("connectionTimeoutMilliseconds", "connectionTimeout");  
	PROP_SYNONYMS.put("idleTimeoutMilliseconds", "idleTimeout");  
	PROP_SYNONYMS.put("maxLifetimeMilliseconds", "maxLifetime");  
	PROP_SYNONYMS.put("maxPoolSize", "maximumPoolSize");  
	PROP_SYNONYMS.put("minPoolSize", "minimumIdle");
```

<font color="#ffc000">标准属性</font>

```yaml
minPoolSize: 20  
connectionTimeoutMilliseconds: 30000  
maxLifetimeMilliseconds: 1800000
idleTimeoutMilliseconds: 60000
maxPoolSize: 50  
```

<font color="#ffc000">本地属性</font>

```
minimumIdle: 20  
connectionTimeout: 30000  
maxLifetime: 1800000
idleTimeout: 60000
maximumPoolSize: 50  
```

最终生成对象如下：

![[Pasted image 20240314163729.png|450]]

### 3.CustomDataSourcePoolProperties


```java
// props
// standardPropertyKeys: 就是将上述connectionPropertySynonyms对象和poolPropertySynonyms中的标准属性key的集合
// - dataSourceClassName           -- org.apache.shardingsphere.infra.datasource.pool.props.domain.synonym.ConnectionPropertySynonyms
// - url                           -- org.apache.shardingsphere.infra.datasource.pool.props.domain.synonym.ConnectionPropertySynonyms
// - username                      -- org.apache.shardingsphere.infra.datasource.pool.props.domain.synonym.ConnectionPropertySynonyms
// - password                      -- org.apache.shardingsphere.infra.datasource.pool.props.domain.synonym.ConnectionPropertySynonyms
// - connectionTimeoutMilliseconds -- org.apache.shardingsphere.infra.datasource.pool.props.domain.synonym.PoolPropertySynonym
// - idleTimeoutMilliseconds       -- org.apache.shardingsphere.infra.datasource.pool.props.domain.synonym.PoolPropertySynonym
// - maxLifetimeMilliseconds       -- org.apache.shardingsphere.infra.datasource.pool.props.domain.synonym.PoolPropertySynonym
// - maxPoolSize                   -- org.apache.shardingsphere.infra.datasource.pool.props.domain.synonym.PoolPropertySynonym
// - minPoolSize                   -- org.apache.shardingsphere.infra.datasource.pool.props.domain.synonym.PoolPropertySynonym
// - readOnly                      -- org.apache.shardingsphere.infra.datasource.pool.props.domain.synonym.PoolPropertySynonym
// transientFieldNames: running,poolName,closed  -- org.apache.shardingsphere.infra.datasource.pool.hikari.metadata.HikariDataSourcePoolMetaData#TRANSIENT_FIELD_NAMES
// propertySynonyms: 在使用HikariCP数据库连接池时，对应org.apache.shardingsphere.infra.datasource.pool.hikari.metadata.HikariDataSourcePoolMetaData#PROP_SYNONYMS属性
new CustomDataSourcePoolProperties(props, standardPropertyKeys, transientFieldNames, propertySynonyms)
```

```java
STANDARD_PROPERTY_KEYS // org.apache.shardingsphere.infra.datasource.pool.props.domain.synonym.ConnectionPropertySynonyms
	STANDARD_PROPERTY_KEYS.add("dataSourceClassName");  
	STANDARD_PROPERTY_KEYS.add("url");  
	STANDARD_PROPERTY_KEYS.add("username");  
	STANDARD_PROPERTY_KEYS.add("password");
STANDARD_PROPERTY_KEYS // org.apache.shardingsphere.infra.datasource.pool.props.domain.synonym.PoolPropertySynonyms
	STANDARD_PROPERTY_KEYS.add("connectionTimeoutMilliseconds");  
	STANDARD_PROPERTY_KEYS.add("idleTimeoutMilliseconds");  
	STANDARD_PROPERTY_KEYS.add("maxLifetimeMilliseconds");  
	STANDARD_PROPERTY_KEYS.add("maxPoolSize");  
	STANDARD_PROPERTY_KEYS.add("minPoolSize");  
	STANDARD_PROPERTY_KEYS.add("readOnly");

PROP_SYNONYMS // org.apache.shardingsphere.infra.datasource.pool.hikari.metadata.HikariDataSourcePoolMetaData
	PROP_SYNONYMS.put("url", "jdbcUrl");  
	PROP_SYNONYMS.put("connectionTimeoutMilliseconds", "connectionTimeout");  
	PROP_SYNONYMS.put("idleTimeoutMilliseconds", "idleTimeout");  
	PROP_SYNONYMS.put("maxLifetimeMilliseconds", "maxLifetime");  
	PROP_SYNONYMS.put("maxPoolSize", "maximumPoolSize");  
	PROP_SYNONYMS.put("minPoolSize", "minimumIdle");
```

```yaml
driverClassName: com.mysql.cj.jdbc.Driver  
jdbcUrl: jdbc:mysql://10.2.3.157:3306/windranger_emr?characterEncoding=utf8&serverTimezone=GMT%2B8&allowMultiQueries=true  
username: user                                                                                                                  # 在standardPropertyKeys存在移除
password: Lachesis-mh_1024                                                                                                      # 在standardPropertyKeys存在移除
connectionTimeoutMilliseconds: 30000                                                                                            # 在standardPropertyKeys存在移除
idleTimeoutMilliseconds: 60000                                                                                                  # 在standardPropertyKeys存在移除
maxLifetimeMilliseconds: 1800000                                                                                                # 在standardPropertyKeys存在移除
maxPoolSize: 50                                                                                                                 # 在standardPropertyKeys存在移除
minPoolSize: 20                                                                                                                 # 在standardPropertyKeys存在移除
poolName: sharding_emr_ds0                                                                                                      # 在transientFieldNames存在移除
```

最终生成对象如下：

![[Pasted image 20240314165750.png|500]]


## 2.DataSource创建


创建数据库连接池的核心链路

```
org.apache.shardingsphere.driver.jdbc.core.driver.DriverDataSourceCache#createDataSource
  - org.apache.shardingsphere.driver.api.yaml.YamlShardingSphereDataSourceFactory#createDataSource
	  - org.apache.shardingsphere.infra.datasource.pool.creator.DataSourcePoolCreator#create
	  - org.apache.shardingsphere.infra.datasource.pool.creator.DataSourcePoolCreator#create(org.apache.shardingsphere.infra.datasource.pool.props.domain.DataSourcePoolProperties) --- 最终核心方法
```

![[Pasted image 20240314170305.png|1000]]

核心方法

```java
public static DataSource create(DataSourcePoolProperties props) {  
    // 1.反射创建独享
    DataSource result = create(props.getPoolClassName());
    // 2.获取HikariCP的DataSourcePoolMetaData实现
    // org.apache.shardingsphere.infra.datasource.pool.hikari.metadata.HikariDataSourcePoolMetaData
    Optional<DataSourcePoolMetaData> poolMetaData = TypedSPILoader.findService(DataSourcePoolMetaData.class, props.getPoolClassName());
    // 3.创建DataSourcePoolReflection反射对象（可以理解为工具对象）
    DataSourcePoolReflection dataSourcePoolReflection = new DataSourcePoolReflection(result);
    // 默认为HikariCP实现
    if (poolMetaData.isPresent()) {  
        // 4.设置默认属性
        setDefaultFields(dataSourcePoolReflection, (DataSourcePoolMetaData)poolMetaData.get());  
        //
        setConfiguredFields(props, dataSourcePoolReflection, (DataSourcePoolMetaData)poolMetaData.get());  
        appendJdbcUrlProperties(props.getCustomProperties(), result, (DataSourcePoolMetaData)poolMetaData.get(), dataSourcePoolReflection);  
        dataSourcePoolReflection.addDefaultDataSourcePoolProperties((DataSourcePoolMetaData)poolMetaData.get());  
    } else {  
        setConfiguredFields(props, dataSourcePoolReflection);  
    }  
    return result;  
}
```

### 1.反射创建DataSource对象

![[Pasted image 20240314170616.png|1100]]

### 2.获取DataSourcePoolMetaData实现


### 3.创建DataSourcePoolReflection反射对象


### 4.设置默认属性

```java
// org.apache.shardingsphere.infra.datasource.pool.hikari.metadata.HikariDataSourcePoolMetaData
private static void buildDefaultProperties() {  
    DEFAULT_PROPS.put("connectionTimeout", 30000L);  
    DEFAULT_PROPS.put("idleTimeout", 60000L);  
    DEFAULT_PROPS.put("maxLifetime", 2100000L);  
    DEFAULT_PROPS.put("maximumPoolSize", 50);  
    DEFAULT_PROPS.put("minimumIdle", 1);  
    DEFAULT_PROPS.put("readOnly", false);  
    DEFAULT_PROPS.put("keepaliveTime", 0);  
}
```

### 5.设置配置属性

```java
private static void setConfiguredFields(DataSourcePoolProperties props, DataSourcePoolReflection dataSourcePoolReflection, DataSourcePoolMetaData poolMetaData) {  
	// 获取本地化的属性
    Iterator var3 = props.getAllLocalProperties().entrySet().iterator();  
    while(var3.hasNext()) {  
        Map.Entry<String, Object> entry = (Map.Entry)var3.next();  
        String fieldName = (String)entry.getKey();  
        Object fieldValue = entry.getValue();  
        if (isValidProperty(fieldName, fieldValue, poolMetaData) && !fieldName.equals(poolMetaData.getFieldMetaData().getJdbcUrlPropertiesFieldName())) {  
            dataSourcePoolReflection.setField(fieldName, fieldValue);  
        }  
    }  
}
```

因为这里使用HikariCP进行创建，所以会获取<font color="#f79646">所有</font>本地化属性：

![[Pasted image 20240314171509.png|1000]]

### 6.追加JDBC连接属性

```java
private static void appendJdbcUrlProperties(CustomDataSourcePoolProperties customPoolProps, DataSource targetDataSource, DataSourcePoolMetaData poolMetaData, DataSourcePoolReflection dataSourcePoolReflection) {  
    String jdbcUrlPropertiesFieldName = poolMetaData.getFieldMetaData().getJdbcUrlPropertiesFieldName();  
    if (null != jdbcUrlPropertiesFieldName && customPoolProps.getProperties().containsKey(jdbcUrlPropertiesFieldName)) {  
        Map<String, Object> jdbcUrlProps = (Map)customPoolProps.getProperties().get(jdbcUrlPropertiesFieldName);  
        DataSourcePoolMetaDataReflection dataSourcePoolMetaDataReflection = new DataSourcePoolMetaDataReflection(targetDataSource, poolMetaData.getFieldMetaData());  
        dataSourcePoolMetaDataReflection.getJdbcConnectionProperties().ifPresent((optional) -> {  
            setJdbcUrlProperties(dataSourcePoolReflection, optional, jdbcUrlProps, jdbcUrlPropertiesFieldName);  
        });  
    }  
}
```

### 7.添加默认数据库连接池属性

`org.apache.shardingsphere.infra.datasource.pool.creator.DataSourcePoolReflection#addDefaultDataSourcePoolProperties`


# QA

## 1.配置问题

暂不支持配置`poolName`属性：https://github.com/apache/shardingsphere/issues/17646