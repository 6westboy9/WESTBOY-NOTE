

# 网络模式

https://www.51cto.com/article/719585.html

## 桥接

![[Pasted image 20240611145414.png|500]]

虚拟机连接VMnet0虚拟交换机，虚拟交换机和物理机的网卡桥接，共享物理网卡的网络，从而实现虚拟机访问外网。虚拟机和物理机在同一个网络内，虚拟机的IP地址也是由同一网段的DHCP服务器分配的。

> VMnet0有什么用？

VMware0没啥用，桥接可以上网的物理网卡，虚拟机就可以直接上网。而VMnet0是为物理机创建的虚拟桥接网卡，桥接VMnet0，只能实现VMnet0虚拟网络内互通，无法访问外网，效果跟主机模式是一样的。

> 桥接模式下，复制物理网络连接状态是什么功能？

虚拟机选择桥接模式时，有一个可选项：复制物理网络连接状态。这个功能是在物理机网络切换时使用，比如物理网卡从有线网络切换到无线网络时，虚拟机能检测到网络变化，并进行重连接，切换到物理机的无线网络中。不开启这个功能，虚拟机是不会检测物理网卡状态变化的。

> 物理机ping不通虚拟机，虚拟机也ping不通物理机，是为什么？

网络配置正确的情况下，物理机或虚拟机的防火墙，默认是开启状态，会禁ping。关闭防火墙功能，即可互相ping通。
## NAT

![[Pasted image 20240611145435.png|500]]

* 首先是物理机的VMnet8网卡，连接到了VMnet8虚拟交换机，DHCP服务器自动给虚拟机分配192.168.5.0/24网段的IP地址，实现物理机和虚拟机、虚拟机之间的网络互联，但是还不能访问外网。
* 然后查看另外一条链路，是物理网卡和NAT设备相连，实现NAT功能。通过默认配置，可以发现VMnet8网络的网关地址是192.168.5.2，也就是NAT设备。通过NAT链路，192.168.5.0/24网段就能转换成192.168.0.100访问外网。
* 与桥接模式对比，NAT模式把虚拟网络和物理机网络进行了隔离，安全性提升了；NAT模式使用自定义网段，不消耗物理网络的IP地址资源，扩展性增强了；NAT模式下，需要做NAT映射，才能访问虚拟机，配置变复杂，不利于管理和运维。

## 主机


![[Pasted image 20240611145505.png|500]]

物理机上各个网卡之间的网络是相互隔离的，要想跟对应的网卡或网络通信时，必须要配置成同网段的地址才能通信。DHCP的配置，也可以根据实际情况，进行地址池配置修改，还可以关闭DHCP功能，使用静态配置。


# NAT模式下共享宿主机的Clash VPN

[链接](https://www.skfwe.cn/p/clash%E8%AE%A9%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%B3%BB%E7%BB%9Flinux-%E5%85%B1%E4%BA%AB%E4%B8%BB%E6%9C%BA%E7%9A%84%E4%BB%A3%E7%90%86)

1.宿主机设置

![[Pasted image 20240612110257.png|500]]

![[Pasted image 20240612110403.png|500]]

2.虚拟机设置

```bash
# ~/.bashrc中添加
export https_proxy=http://10.2.43.39:7890
export http_proxy=http://10.2.43.39:7890
export all_proxy=socks5://10.2.43.39:7890

source ~/.bashrc
```