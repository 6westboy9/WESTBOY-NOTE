# 1.CR

>Java群

项目：mnis
内容：35254 【湛江中心人民医院】-有一个病区的PC端-床位列表页面，没有患者名字这列
分支：fix_release_mnis_v3.8_wpb_35254 into release_mnis_v3.8
MR：

# 2.脚本

>邮件

> [!danger] 注意事项
> 提供脚本为实际线上脚本，所以必须考虑实际线上情况
> 1.开关，默认应为关闭（根据实际情况而定）
> 2.IP地址，默认应为127.0.0.1（一般情况）

---

宝哥麻烦归档下脚本：

测试环境：10.2.3.170
项目：mnis
冲刺版本：
单号：
版本号：MNIS V3.8.134
分支：

MySQL脚本

```sql

```


> [!danger] 注意事项
> 脚本后不要带 `;` ~

MongDB脚本

```js
use mnis

// 1.过滤掉空数据
const docs = db.wardBedCustomColumnConfig.find({});

docs.forEach(doc => {
  const filteredItems = doc.wardBedCustomColumnConfigItem.filter(item => {
    return item.hasOwnProperty('originalDataName') && item.hasOwnProperty('dataName');
  });

  db.wardBedCustomColumnConfig.updateOne(
    { _id: doc._id },
    { $set: { wardBedCustomColumnConfigItem: filteredItems } }
  );
});

// 2.重新添加数据
var configs = db.getCollection("wardBedCustomColumnConfig").find({});

var allergen = {
    "isChecked": true,
    "isEdit": true,
    "dataIndex": "allergen",
    "originalDataName": "过敏史",
    "dataName": "过敏史",
    "sortNo": 27,
    "width": 100
};

var doctorName = {
    "isChecked": true,
    "isEdit": true,
    "dataIndex": "doctorName",
    "originalDataName": "管床医生",
    "dataName": "管床医生",
    "sortNo": 11,
    "width": 124
};

var thrombusFirst = {
    "dataIndex": "thrombusFirst",
    "isChecked": true,
    "isEdit": true,
    "originalDataName": "血栓1",
    "dataName": "血栓1",
    "sortNo": 24,
    "width": 124
}

var thrombusSecond = {
    "dataIndex": "thrombusSecond",
    "isChecked": true,
    "isEdit": true,
    "originalDataName": "血栓2",
    "dataName": "血栓2",
    "sortNo": 25,
    "width": 124
}

var vteLevel = {
    "dataIndex": "vteLevel",
    "isChecked": true,
    "isEdit": true,
    "originalDataName": "VTE",
    "dataName": "VTE",
    "sortNo": 26,
    "width": 124
}

var requiredFields = [
    { key: "allergen", obj: allergen },
    { key: "doctorName", obj: doctorName },
    { key: "thrombusFirst", obj: thrombusFirst },
    { key: "thrombusSecond", obj: thrombusSecond },
    { key: "vteLevel", obj: vteLevel }
];

configs.forEach(function (config) {
    var children = config.wardBedCustomColumnConfigItem || [];
    var existingKeys = new Set(children.map(child => child.dataIndex));

    requiredFields.forEach(function (field) {
        if (!existingKeys.has(field.key)) {
            children.push(field.obj);
        }
    });

    config.wardBedCustomColumnConfigItem = children;
    db.getCollection("wardBedCustomColumnConfig").save(config);
});

```

# 3.提测单

>提测群


# 4.其它
