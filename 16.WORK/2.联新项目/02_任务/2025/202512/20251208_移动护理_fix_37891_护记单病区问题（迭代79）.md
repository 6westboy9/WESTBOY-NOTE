# 1.CR  
  
>Java群  

项目：mnis  
内容：37891【江门市中心医院】-一般护理记录单自动生成的皮试、输血记录，转科患者记录的ward_code不是当前所在科室
* 线程池配置代码优化
* @Async异步日志TraceId优化
* 护记单病区日志补充
* 第三方体温单同步日志补充
* 暂存回写请求日志（保留最近10天）
分支：fix_release_mnis_v3.8_wpb_37891 into qa_mnis_v3.8
MR：http://10.2.3.111:86/backend_group/backend_application/mnis/merge_requests/7752

# 2.脚本  
  
>邮件  
  
> [!danger] 注意事项  
> 提供脚本为实际线上脚本，所以必须考虑实际线上情况  
> 1.开关，默认应为关闭（根据实际情况而定）  
> 2.IP地址，默认应为127.0.0.1（一般情况）  
  
---  
  
宝哥麻烦归档下脚本：  
  
测试环境：10.2.3.170  
项目：mnis
单号：37891  
版本号：MNIS V3.8.159
分支：fix_release_mnis_v3.8_wpb_37891
  
MySQL脚本  
  
```sql

```  
  
  
> [!danger] 注意事项  
> 脚本后不要带 `;` ~  
  
MongDB脚本  
  
```js  
use mnis

// 创建 sendRequestLog 集合（如果不存在）
try {
  db.createCollection("sendRequestLog");
  print("成功创建 sendRequestLog 集合");
} catch (e) {
  if (e.code == 48) { // NamespaceExists 错误代码
	  print("sendRequestLog 集合已存在，跳过创建");
  } else {
	  print("创建集合时发生错误: " + e.message);
	  // 如果是其他错误，继续执行
  }
}

// 删除可能存在的旧索引（确保可重复执行）
try {
  db.sendRequestLog.dropIndex("idx_startTime");
  print("已删除旧的 idx_startTime 索引");
} catch (e) {
  print("索引 idx_startTime 不存在或删除失败: " + e.message);
}

// 创建 TTL 索引，10天后自动过期删除 (864000秒 = 10天)
db.sendRequestLog.createIndex(
  { "startTime": 1 },
  {
	  name: "idx_startTime",
	  expireAfterSeconds: 864000
  }
);

print("成功创建 sendRequestLog 集合的 idx_startTime 索引");
print("索引将在 startTime 字段上创建，10天后自动删除过期文档");

// 验证索引创建结果
print("\n当前 sendRequestLog 集合的索引列表:");
db.sendRequestLog.getIndexes().forEach(function(index) {
  print("索引名称: " + index.name + ", 键: " + JSON.stringify(index.key) +
		(index.expireAfterSeconds ? ", TTL过期时间: " + index.expireAfterSeconds + "秒" : ""));
});
```  
  
# 3.提测单  
  
>提测群  


  
# 4.其它