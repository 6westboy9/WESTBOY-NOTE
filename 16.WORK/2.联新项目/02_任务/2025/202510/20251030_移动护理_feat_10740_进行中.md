## 1.CR  
  
>Java群  

项目：mnis  
内容：10740【湛江中心人民医院】-长期医嘱停止后，仍在输液巡视单中显示
分支：feat_release_mnis_v3.8_wpb_10740_1 into qa_mnis_v3.8
MR：http://10.2.3.111:86/backend_group/backend_application/mnis/merge_requests/7550

# 2.脚本  
  
>邮件  
  
> [!danger] 注意事项  
> 提供脚本为实际线上脚本，所以必须考虑实际线上情况  
> 1.开关，默认应为关闭（根据实际情况而定）  
> 2.IP地址，默认应为127.0.0.1（一般情况）  
  
---  
  
宝哥麻烦归档下脚本：  
  
测试环境：10.2.3.170  
项目：mnis
单号：10740  
版本号：MNIS V3.8.153
分支：feat_release_mnis_v3.8_wpb_10740
  
MySQL脚本  
  
```sql
use windranger_auth;  
delete from windranger_auth.sys_resource where resource_code = 'mnisApplicationConfig';  
INSERT INTO windranger_auth.sys_resource (resource_code, resource_name, resource_type, resource_content, resource_desc, parent_resource_code, app_type, resource_icon, app_version, ad, is_out, resource_codes_for_external, resource_icon_active, engine, is_mobile_resource, create_time, create_person, update_time, update_person, sort_no, hide_in_menu, has_config, is_public) VALUES ('mnisApplicationConfig', 'MNIS配置', '0', 'mnisApplicationConfig', null, 'applicationConfig', null, null, null, null, null, null, null, 'react', 0, '2025-09-19 10:03:00', '123', null, null, null, 0, null, 0);
```  
  
  
> [!danger] 注意事项  
> 脚本后不要带 `;` ~  
  
MongDB脚本  
  
```js  
use mnis
db.getCollection("docTemplatePrint").createIndex({ "templateCode": 1 })


use coms
db.sysConfigFile.remove({key: 'mnisApplicationConfig'})
db.sysConfigFile.insert({
	"_id" : ObjectId("6902d87b07cc4df4b12eba35"),
	"key" : "mnisApplicationConfig",
	"pattern" : {
		"componentType" : "Tab",
		"label" : "拆分医嘱过滤配置",
		"forAllWards" : true
	},
	"children" : [
		{
			"_id" : "6902d87b07cc4df4b12eba35-Thu Oct 30 2025 11:16:58 GMT+0800",
			"key" : "enableLogDetail",
			"pattern" : {
				"componentType" : "Switch",
				"label" : "是否输出过滤明细"
			},
			"value" : false
		}
	],
	"relatedContents" : [ "mnisApplicationConfig" ],
	"updatePerson" : "123",
	"updateTime" : ISODate("2025-10-30T13:10:50.127+08:00"),
	"createTime" : ISODate("2021-01-04T22:28:30.327+08:00"),
	"createPerson" : "123",
	"_class" : "com.lachesis.windranger.foundation.model.config.SysConfigFile"
})

db.sysConfigFile.updateOne({ 'key': 'filterDiscontinuedOrders' }, { "$pull": { 'children': { 'key': { $in: ['version'] } } } })
db.sysConfigFile.updateOne({ 'key': 'filterDiscontinuedOrders' }, {
    "$push": {
        "children":
        {
			"_id" : "17609449323632",
			"key" : "version",
			"pattern" : {
				"componentType" : "Radio",
				"label" : "医嘱停止过滤实现版本",
				"urlOptionSourceDetail" : {
					
				},
				"optionSourceDetail" : "",
				"optionSource" : "options",
				"options" : [
					{
						"sortedIndex" : 1,
						"code" : "v1",
						"name" : "v1"
					},
					{
						"sortedIndex" : 2,
						"code" : "v2",
						"name" : "v2"
					}
				]
			},
			"value" : "v1"
		}
    }
})

db.sysConfigFile.updateOne({ 'key': 'filterDiscontinuedOrders' }, { "$pull": { 'children': { 'key': { $in: ['filterNumberOfLastChargesFilterRule',] } } } })
db.sysConfigFile.updateOne({ 'key': 'filterDiscontinuedOrders' }, {
    "$push": {
        "children":
        {
			"_id" : "17609427287831",
			"key" : "filterNumberOfLastChargesFilterRule",
			"pattern" : {
				"componentType" : "Radio",
				"label" : "医嘱按末次收费次数显示计算过滤规则",
				"urlOptionSourceDetail" : {
					
				},
				"optionSourceDetail" : "",
				"options" : [
					{
						"sortedIndex" : 1,
						"code" : "filterByOrderSortNo",
						"name" : "按照orderSortNo值"
					},
					{
						"sortedIndex" : 2,
						"code" : "filterAfterGroupByOrderGroupNoAndSortValue",
						"name" : "按照orderGroupNo分组排序值"
					}
				]
			},
			"value" : "filterByOrderSortNo"
		}
    }
})
```  
  
# 3.提测单  
  
>提测群  

http://183.62.162.28:1024/zentao/testtask-view-10209.html#app=execution
10740【湛江中心人民医院】-长期医嘱停止后，仍在输液巡视单中显示

测试关注点：

* 医嘱执行单
	* 按照频次过滤
	* 按照停嘱过滤
* 输液单
	* 按照停嘱过滤

**过滤日志明细**

只有在开启配置的情况下才会输出（以防日志爆炸）

默认配置关闭

![[Pasted image 20251030114439.png|L|1000]]

**样例**

![[Pasted image 20251030114348.png|L|1400]]
  
# 4.其它