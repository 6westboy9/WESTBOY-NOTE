# 1.CR

>Java群

项目：mnis  
内容：34283【清华大学附属北京清华长庚医院】升级后mnis服务起不来
分支：fix_release_mnis_v3.8_wpb_34283 into release_mnis_v3.8
MR：

# 2.脚本

>邮件

> [!danger] 注意事项
> 提供脚本为实际线上脚本，所以必须考虑实际线上情况
> 1.开关，默认应为关闭（根据实际情况而定）
> 2.IP地址，默认应为127.0.0.1（一般情况）

---

宝哥麻烦归档下脚本：

测试环境：10.2.3.170
项目：mnis
冲刺版本：
单号：34283
版本号：MNIS V3.8.130
分支：fix_release_mnis_v3.8_wpb_34283

MySQL脚本

```sql

```


> [!danger] 注意事项
> 脚本后不要带 `;` ~

MongDB脚本

```js
use mnis
function dropIndexIfExists(name) {
    try {
        var indexes = db.patNursePatrolTaskInfo.getIndexes();
        var indexExists = false;
        for (let i = 0; i < indexes.length; i++) {
            if (indexes[i].name === name) {
                indexExists = true;
                break;
            }
        }

        if (indexExists) {
            db.patNursePatrolTaskInfo.dropIndex(name)
            print("索引已成功删除: " + name)
        } else {
            print("索引不存在, 无需删除: " + name)
        }
    } catch (error) {
        print("删除索引失败: " + name)
    }
}

function createIndexIfNotExists(name) {
    try {
        var indexes = db.patNursePatrolTaskInfo.getIndexes();
        var indexExists = false;
        for (let i = 0; i < indexes.length; i++) {
            if (indexes[i].name === name) {
                indexExists = true
                break
            }
        }

        if (indexExists) {
            print("索引已存在, 无需创建: " + name);
        } else {
            print("索引不存在, 进行创建: " + name);
            db.patNursePatrolTaskInfo.createIndex(
                { pointTime: 1 },
                { expireAfterSeconds: 2592000, name: name }
            )
        }
    } catch (error) {
        print("创建索引失败: " + name)
    }
}

dropIndexIfExists("idx_createTime")
createIndexIfNotExists("idx_pointTime")
```

# 3.提测单

>提测群

http://10.2.3.109:1024/zentao/testtask-view-9078.html
34016【清华大学附属北京清华长庚医院】输血执行、输血巡视、输血完成的护理记录内容需要回传同步程序 --- 已提测

# 4.其它





