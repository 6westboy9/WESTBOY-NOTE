# 概述


主要分为三部分：<font color="#f79646">文书页头</font>、<font color="#f79646">表体表头</font>和<font color="#f79646">文书页尾</font>。

项目属性

|          | 类型   |                                                   | 是否默认显示                         | 示例                          |
| -------- | ---- | ------------------------------------------------- | ------------------------------ | --------------------------- |
| 项目编号     | 文本   | 禁止输出                                              | 是                              | P00027950                   |
| 项目名称     | 文本   | 默认为项目编号                                           | 是                              | 出生日期                        |
| 描述       | 文本   |                                                   | 是                              |                             |
| 结构化类型    | 下拉单选 |                                                   | 是                              | 接口路径：docStructType/category |
| 表头类型     | 下拉单选 | 1.固定表头 2.自定义表头                                    | 是                              |                             |
| 自定义表头项   | 下拉单选 | <font color="#c0504d">当表头类型选为自定义时，才显示，否则隐藏</font> | <font color="#c0504d">否</font> | 1,2,3                       |
| 控件类型     | 下拉单选 | 1.文本框 2.文本框 ...                                   | 是                              |                             |
| 关联数据源    | 下拉单选 |                                                   | 是                              |                             |
| 同步至体温单   | 单选   |                                                   | 是                              |                             |
| 添加底色     | 单选   |                                                   | 是                              |                             |
| 关联宫口扩张曲线 | 单选   |                                                   | 是                              |                             |
| 关联先露下降曲线 | 单选   |                                                   | 是                              |                             |
| 关联分娩     | 单选   |                                                   | 是                              |                             |

* <font color="#f79646">表头的概念类似于Excel的Sheet页，一个表头相当于一个Sheet页，一个文书有多个表头~</font>
* 表头的headerCode在新增的时候由服务端生成
* 在新增文书的时候，就会默认创建第一个表头和表头明细
	* <font color="#4f81bd">表头明细表</font>才存储具体每个表的头部信息元数据
	* <font color="#4f81bd">表头表</font>维护的是患者文书与表的关联关系


# 大类&结构化类型&项目

页面配置入口：<font color="#9bbb59">实施配置 - 基础配置功能</font>

> [!warning] 注意
> 大类、结构化类型、项目是<font color="#f79646">三级</font>联动

新增结构项目时，需要选择大类和项目类型，这里的<font color="#f79646">大类</font>和<font color="#f79646">项目类型</font>维护关系在结构化类型维护中。

![[Pasted image 20240522100755.png|400]]

## 大类

<font color="#f79646">在搞清楚结构化类型之前，先要搞清楚大类，大类来自哪里？</font>

页面配置入口：<font color="#9bbb59">系统配置 - 字典</font>

```sql
-- 数据存储
select * from windranger_foundation.sys_dic where dic_type = 'documentMajorCategory';
```

| seq | dic\_code         | dic\_name | dic\_type             |
| :-- | :---------------- | :-------- | :-------------------- |
| 1   | evaluate-document | 评估单       | documentMajorCategory |
| 2   | nursing-document  | 护理记录      | documentMajorCategory |
| 3   | quality-document  | 质控        | documentMajorCategory |
| 4   | adverse-document  | 不良事件      | documentMajorCategory |
| 5   | manual-document   | 护士长手册     | documentMajorCategory |
| 6   | ordinary-document | 普通文书      | documentMajorCategory |

## 结构化类型

页面配置入口：<font color="#9bbb59">实施配置 - 基础配置功能 - 结构化类型维护</font>

![[Pasted image 20240522100130.png|1600]]

接口请求信息

```
GET http://10.2.3.170:86/api/windranger/docStructType/category?
majorCategoryCodes=evaluate-document
&majorCategoryCodes=nursing-document
&majorCategoryCodes=quality-document
&majorCategoryCodes=adverse-document
&majorCategoryCodes=manual-document
&majorCategoryCodes=ordinary-document
&majorCategoryCodes=lina-document
```

响应结果

```json
[
    {
        "seqId": 128,
        "status": 1,
        "typeName": "评估",                                       // 结构化类型名称
        "typeCode": "nurse",                                     // 结构化类型编号
        "isFactorySetting": false,
        "majorCategoryCode": "evaluate-document",                // 大类编码
        "createTime": "2021-03-04T17:36:20.000+0800",
        "createPerson": "123",
        "updateTime": null,
        "updatePerson": null
    },
    ...
    {
        "seqId": 162,
        "status": 1,
        "typeName": "中医护理方案",
        "typeCode": "tcmNursePlan",
        "isFactorySetting": false,
        "majorCategoryCode": "ordinary-document",
        "createTime": "2024-03-19T17:53:17.000+0800",
        "createPerson": "123",
        "updateTime": null,
        "updatePerson": null
    }
]
```

```sql
-- 数据存储
select * from windranger_mnis.doc_struct_type where status = 1;
```

| type\_name | type\_code           | is\_factory\_setting | major\_category\_code |
| :--------- | :------------------- | :------------------- | :-------------------- |
| 分娩结果       | childbirthResult     | 0                    | nursing-document      |
| 中医护理方案     | tcmNursePlan         | 0                    | ordinary-document     |
| 不良事件类型     | 1001                 | 0                    | adverse-document      |
| 多评估风险等级    | multiEvaluateLevel   | 0                    | evaluate-document     |
| 随访人员       | followUpUser         | 0                    | ordinary-document     |
| 压力性损伤类型    | stressInjuryType     | 0                    | evaluate-document     |
| lina评分类型   | linaScoreType        | 0                    | lina-document         |
| 风险评估单录入    | riskEvalutionInput   | 0                    | nursing-document      |
| 随访异常结果     | followUpErrorResult  | 0                    | ordinary-document     |
| 随访正常结果     | followUpNormalResult | 0                    | ordinary-document     |
| 血糖         | bloodSugarRecord     | 0                    | nursing-document      |
| 评估引用       | evaluationQuote      | 0                    | nursing-document      |
| 转运文书       | transfer             | 0                    | ordinary-document     |
| 临产记录项目     | laborRecordItems     | 0                    | nursing-document      |
| 签名         | thirdSign            | 0                    | ordinary-document     |
| 督导         | supervision          | 0                    | nursing-document      |
| 整改单引用检查单   | referenceChecklist   | 0                    | quality-document      |
| 护理计划       | nursePlan            | 0                    | nursing-document      |
| 护理记录基础项目   | nurseBase            | 0                    | nursing-document      |
| 体征         | vitalsign            | 0                    | nursing-document      |
| 评估         | nurse                | 0                    | evaluate-document     |

## 结构化项目

页面配置入口：<font color="#9bbb59">实施配置 - 基础配置功能 - 结构化项目维护</font>

![[Pasted image 20240528155356.png|1600]]

接口请求信息

```
GET http://10.2.3.170:86/api/windranger/docStructProjectExt?typeCode=nurse
```

响应结果

```json
{
    "totalCnt": -1,
    "queryResult": [
        {
            "seqId": 221,
            "typeCode": "nurse",
            "itemCode": "painScore",
            "itemName": "疼痛评分",
            "isFactorySetting": 0,
            "dataStatus": 1,
            "isRecordStatistics": 0,
            "createTime": "2022-06-09T22:18:31.000+0800",
            "createPerson": "123",
            "updateTime": null,
            "updatePerson": null,
            "majorCategoryCode": "evaluate-document",
            "majorCategoryName": "评估单",
            "typeName": "评估"
        },
        ...
        {
            "seqId": 231,
            "typeCode": "nurse",
            "itemCode": "itemCode：item_1-2",
            "itemName": "项目1-2",
            "isFactorySetting": 0,
            "dataStatus": 1,
            "isRecordStatistics": 0,
            "createTime": "2022-12-28T16:18:08.000+0800",
            "createPerson": "123",
            "updateTime": null,
            "updatePerson": null,
            "majorCategoryCode": "evaluate-document",
            "majorCategoryName": "评估单",
            "typeName": "评估"
        }
    ]
}
```

```sql
-- 查询结构化类型为体征的项目
select * from windranger_mnis.doc_struct_project where type_code = 'vitalsign';
```

| type\_code | item\_code        | item\_name |
| :--------- | :---------------- | :--------- |
| vitalsign  | temperature       | 体温         |
| vitalsign  | pulse             | 脉搏         |
| vitalsign  | breath            | 呼吸         |
| vitalsign  | bloodPress        | 血压         |
| vitalsign  | oxygen            | 血氧         |
| vitalsign  | inputML           | 入量         |
| vitalsign  | outputName        | 出量名称       |
| vitalsign  | inputName         | 入量名称       |
| vitalsign  | outputML          | 出量         |
| vitalsign  | ys                | 意识         |
| vitalsign  | heartRate         | 心率         |
| vitalsign  | bloodSugar        | 血糖         |
| vitalsign  | fetalHeartRate    | 胎心率        |
| vitalsign  | allergy           | 过敏药物       |
| vitalsign  | inputType         | 入量类型名称     |
| vitalsign  | outputType        | 出量类型名称     |
| vitalsign  | specializedIntake | 专科入量       |
| vitalsign  | specializedOutput | 专科出量       |
| vitalsign  | outPutExcrement   | 出量-大便      |
| vitalsign  | stool             | 大便次数       |
## 存储关系图

>windranger_mnis.doc_struct_type <font color="#9bbb59">结构化项目种类表</font>

| type\_name | type\_code           | is\_factory\_setting | major\_category\_code |
| :--------- | :------------------- | :------------------- | :-------------------- |
| 评估         | nurse                | 0                    | evaluate-document     |
| 体征         | vitalsign            | 0                    | nursing-document      |
| 护理记录基础项目   | nurseBase            | 0                    | nursing-document      |
| 护理计划       | nursePlan            | 0                    | nursing-document      |
| 整改单引用检查单   | referenceChecklist   | 0                    | quality-document      |
| 督导         | supervision          | 0                    | nursing-document      |
| 签名         | thirdSign            | 0                    | ordinary-document     |
| 临产记录项目     | laborRecordItems     | 0                    | nursing-document      |
| 转运文书       | transfer             | 0                    | ordinary-document     |
| 评估引用       | evaluationQuote      | 0                    | nursing-document      |
| 血糖         | bloodSugarRecord     | 0                    | nursing-document      |
| 随访正常结果     | followUpNormalResult | 0                    | ordinary-document     |
| 随访异常结果     | followUpErrorResult  | 0                    | ordinary-document     |
| 风险评估单录入    | riskEvalutionInput   | 0                    | nursing-document      |
| lina评分类型   | linaScoreType        | 0                    | lina-document         |
| 压力性损伤类型    | stressInjuryType     | 0                    | evaluate-document     |
| 随访人员       | followUpUser         | 0                    | ordinary-document     |
| 多评估风险等级    | multiEvaluateLevel   | 0                    | evaluate-document     |
| 不良事件类型     | 1001                 | 0                    | adverse-document      |
| 中医护理方案     | tcmNursePlan         | 0                    | ordinary-document     |

>windranger_mnis.doc_struct_project <font color="#9bbb59">文书结构化项目维护</font>

| type\_code | item\_code  | item\_name | is\_factory\_setting | data\_status | is\_record\_statistics |
| :--------- | :---------- | :--------- | :------------------- | :----------- | :--------------------- |
| vitalsign  | temperature | 体温         | 0                    | 1            | 0                      |
| vitalsign  | pulse       | 脉搏         | 0                    | 1            | 0                      |
| vitalsign  | breath      | 呼吸         | 0                    | 1            | 0                      |
| vitalsign  | bloodPress  | 血压         | 0                    | 1            | 0                      |
| vitalsign  | oxygen      | 血氧         | 0                    | 1            | 0                      |
| vitalsign  | inputML     | 入量         | 0                    | 1            | 0                      |
| vitalsign  | outputName  | 出量名称       | 0                    | 1            | 0                      |
| vitalsign  | inputName   | 入量名称       | 0                    | 1            | 0                      |
| vitalsign  | outputML    | 出量         | 0                    | 1            | 0                      |
| vitalsign  | ys          | 意识         | 0                    | 1            | 0                      |
| nurseBase  | date        | 日期         | 0                    | 1            | 0                      |
| nurseBase  | time        | 时间         | 0                    | 1            | 0                      |
| nurseBase  | dateTime    | 日期时间       | 0                    | 1            | 0                      |
| nurseBase  | tsqk        | 特殊情况       | 0                    | 1            | 0                      |
| vitalsign  | heartRate   | 心率         | 0                    | 1            | 0                      |

>windranger_foundation.sys_dic <font color="#9bbb59">系统字典表</font>

```sql
-- documentMajorCategory意为：大类
-- dic_code为大类编码
-- dic_name为大类名称
select * from windranger_foundation.sys_dic where dic_type = 'documentMajorCategory';
```

| dic\_code         | dic\_name | dic\_type             | dic\_type\_name | description |
| :---------------- | :-------- | :-------------------- | :-------------- | :---------- |
| evaluate-document | 评估单       | documentMajorCategory | 文书主要类别          | 护理评估单       |
| nursing-document  | 护理记录      | documentMajorCategory | 文书主要类别          | 护理操作记录      |
| quality-document  | 质控        | documentMajorCategory | 文书主要类别          | 护理质量质控文书    |
| adverse-document  | 不良事件      | documentMajorCategory | 文书主要类别          | 不良事件        |
| manual-document   | 护士长手册     | documentMajorCategory | 文书主要类别          | 护士长手册       |
| ordinary-document | 普通文书      | documentMajorCategory | 文书主要类别          | 普通文书记录      |
>三者之间的关系

![[Pasted image 20240506114401.png|1300]]

感觉之间的关系如下：

1. 大类 = 1级分类
2. doc_struct_type = 2级分类
3. doc_struct_project = 2级分类下的明细

## 思考 <font color="#f79646">TODO</font>

>1.结构化类型和项目作用的作用？

目前使用地方有：

1. 体温单同步功能
2. 关联数据源为文书类型时，依赖结构化类型和项目建立彼此的关联关系

>2.大类的作用是？

| dic\_code         | dic\_name | dic\_type             | dic\_type\_name | description |
| :---------------- | :-------- | :-------------------- | :-------------- | :---------- |
| evaluate-document | 评估单       | documentMajorCategory | 文书主要类别          | 护理评估单       |
| nursing-document  | 护理记录      | documentMajorCategory | 文书主要类别          | 护理操作记录      |
| quality-document  | 质控        | documentMajorCategory | 文书主要类别          | 护理质量质控文书    |
| adverse-document  | 不良事件      | documentMajorCategory | 文书主要类别          | 不良事件        |
| manual-document   | 护士长手册     | documentMajorCategory | 文书主要类别          | 护士长手册       |
| ordinary-document | 普通文书      | documentMajorCategory | 文书主要类别          | 普通文书记录      |

# 项目属性

## 表头类型 <font color="#c0504d">必选</font>

1. 固定表头
2. 自定义表头
3. 自定义表头（关联病区）

自定义表头

* 已经有表头了，不允许修改~
* 没有表头，可以新增~

<font color="#f79646">表头本身是可以支持树形结构的</font>

* 自定义1
	* 自定义A
		* 自定义A1
		* 自定义A2
	* 自定义B
* 自定义2
	* 自定义C

## 关联数据源 <font color="#9bbb59">可选</font>

| 属性       | 说明                                                                                                       |
| -------- | -------------------------------------------------------------------------------------------------------- |
| 关联数据源    | 目前支持5大类：体征、医嘱、患者、手术、文书                                                                                   |
| 关联项      | 对于体征、医嘱、患者、手术来说，就是系统提供的属性列表；对于文书来说，对应所有文书模板名称列表，关联其它文书项目时，是通过彼此相同的<font color="#f79646">结构化项目</font>进行关联 |
| 关联数据编辑   | 即文书页面是否可以编辑此项                                                                                            |
| 关联数据支持更新 | 关联数据时，取关联数据的规则，开启时，取最新关联项内容，关闭时，取最早关联项内容（体征的BMI除外）                                                       |

### 接口

#### 1.查询数据源类型

```json
// GET http://10.2.3.172:10000/api/windranger/docDataSourceConfig/type

[
    {
        "sourceTable": "vitalsign",
        "sourceTableName": "体征",
    },
    {
        "sourceTable": "order",
        "sourceTableName": "医嘱",
    },
    {
        "sourceTable": "patient",
        "sourceTableName": "患者",
    },
    {
        "sourceTable": "surgery",
        "sourceTableName": "手术",
    },
    {
        "sourceTable": "doclink",
        "sourceTableName": "文书",
    }
]
```

#### 2.查询具体指定数据源明细

```json
// GET http://10.2.3.172:10000/api/windranger/docDataSourceConfig/surgery

[
    {
        "id": "661f7b6089ff583d76fefefe",
        "createTime": "2021-12-15T15:30:07.125+0800",
        "createPerson": "00850",
        "sourceTable": "surgery",
        "sourceTableName": "手术",
        "sourceColumn": "surgeryWay",
        "sourceColumnName": "手术方式"
    },
    {
        "id": "661f7b6089ff583d76fefeff",
        "createTime": "2021-12-15T15:30:07.125+0800",
        "createPerson": "00850",
        "sourceTable": "surgery",
        "sourceTableName": "手术",
        "sourceColumn": "surgeryName",
        "sourceColumnName": "手术名称"
    }
]
```

#### 3.文书获取数据源


```json

```


### 存储结构

<font color="#f79646">1.数据源类型</font>

```js
use mnis
// 查询关联数据源类型
db.docDataSourceConfig.distinct("sourceTable")
// MongoDB 4.4版本以下不支持投影
db.docDataSourceConfig.distinct("sourceTable", {}, {projection : {sourceTable:1,sourceTableName:1}})
```

| sourceTable | sourceTableName |
| :---------- | --------------- |
| vitalsign   | 体征              |
| order       | 医嘱              |
| patient     | 患者              |
| surgery     | 手术              |
| doclink     | 文书              |

<font color="#f79646">2.数据源类型的属性字段</font>

> [!important] 除了文书类型，其它类型都是在docDataSourceConfig集合中维护明细内容，文书类型需要先查配置的文书模板，在引用其它文书的项目时，是通过<font color="#f79646">结构化项目</font>建立关联关系

```js
// 查询患者数据
db.docDataSourceConfig.find({sourceTable:'patient'})
```

| sourceColumn | sourceColumnName | sourceTable | sourceTableName |
| :--- | :--- | :--- | :--- |
| bedCode | 床号 | patient | 患者 |
| patName | 患者姓名 | patient | 患者 |
| gender | 性别 | patient | 患者 |
| age | 年龄 | patient | 患者 |
| displayCode | 住院号 | patient | 患者 |
| outDate | 出院日期 | patient | 患者 |
| wardCode | 病区编号 | patient | 患者 |
| wardName | 病区名称 | patient | 患者 |
| weight | 体重 | patient | 患者 |
| inDate | 入院时间 | patient | 患者 |
| contactPerson | 联系人 | patient | 患者 |
| contactPhone | 联系电话 | patient | 患者 |
| nation | 民族 | patient | 患者 |
| maritalStatus | 婚姻状况 | patient | 患者 |
| occupation | 职业 | patient | 患者 |
| nurseLevel | 护理等级 | patient | 患者 |
| personId | 身份证号 | patient | 患者 |
| surgeryName | 手术名称 | patient | 患者 |
| birthDate | 出生日期 | patient | 患者 |
| outDiag | 出院诊断 | patient | 患者 |

## 控件类型

### 签名控件

当选择签名控件候，不可避免的要选择签名方式，目前支持的签名方式有如下几种类型：

>前端写死

|     |         |                |     |
| --- | ------- | -------------- | --- |
| 1   | 单击登录人签名 | clickLoginUser | 1   |
| 2   | 登录人签名   | loginUser      | 1   |
| 3   | 用户密码签名  | account        | 1   |
| 4   | CA签名    | CA             | 1   |
| 5   | 手写板签名   | tablet         | 1   |
| 6   | 图片签名    | picSign        | 1   |
| 7   | 手写签名    | handWriting    |     |
| 8   | 二维码CA签名 | qrCode         |     |

>com.lachesis.windranger.doc.service.impl.DocDataNurseRecordSyncServiceImpl#getSignItemValue

