# 整体架构

```JavaScript
use mnis
// 初始化任务
db.initialTask.find()
// 单个患者补偿初始化任务记录（因为是该患者全量医嘱查询，仅执行一次，如需重新初始化，需删除该记录）
db.patNurseDataInitRecord.find()
// 患者护理信息分段
db.patNurseSegment.find()
// 患者护理巡视任务请求（根据请求生成任务，可以理解为生成巡视任务时的请求快照，方便后续排查问题）
db.patNursePatrolTaskRequest.find()
// 患者护理巡视任务信息
db.patNursePatrolTaskInfo.find()
// 患者巡视关联任务
db.patNursePatrolExtInfo.find()
// 病房巡视统计
db.mnisNursePatrolStatDetail.find()
```



```js
use mnis

db.patNurseSegment.remove({})
db.patNurseSegmentLog.remove({})
db.patNursePatrolTaskRequest.remove({})
db.patNursePatrolTaskInfo.remove({})
db.mnisNursePatrolStatDetail.remove({})
db.patNurseDataInitRecord.remove({})

// 清空任务相关的数据
// 清空前：先看下有多少数据
db.patNursePatrolExtInfo.count({ taskId: { $ne: null } });
// 清空
db.patNursePatrolExtInfo.updateMany(
    {},
    {
        $unset: {
            taskId: "",
            taskStartTime: null,
            taskEndTime: null,
            statTypeId: null,
            statTypeDesc: null
        }
    }
);
// 清空后：再看下有多少数据
db.patNursePatrolExtInfo.count({ taskId: { $ne: null } });

// 删除患者护理信息初始化任务
db.initialTask.remove({beanName:'patNurseInitializer'})
```



```js
var wardCode = "015001-69";
var nurseLevel = 3;
var startDate = new Date("2025-11-04T00:00:00Z");
var endDate = new Date("2025-11-04T08:00:00Z");

var patrolTasks = db.patNursePatrolTask.find({
  wardCode: wardCode,
  nurseLevel: nurseLevel,
  endTime: { $gt: startDate },
  startTime: { $lt: endDate }
}).sort({ startTime: -1 });
```