# 配置

## 用血扫码规则

> [!check] 配置
> 配置路径：移动护理 - 医嘱执行 - 医嘱执行配置 - 用血扫码规则
> 用途：在执行输血操作时，进入对应输血的当前最新节点的入口的扫码规则~


![[Pasted image 20241213160809.png|L|900]]

## 巡视配置

> [!check] 配置
> 配置路径：移动护理 - 医嘱执行 - 医嘱巡视配置

### 暂停/终止原因配置

输血过程，进行终止/暂停操作时，提供的原因选项配置。

![[Pasted image 20241213164044.png|L|600]]

### 输血不良反应症状和措施

当执行输血巡视时，不良反应症状和处理措施选项配置。

![[Pasted image 20241213163636.png|L|900]]

![[Pasted image 20241213163541.png|L|300]]

### 输血暂停后继续执行扫码配置

当执行输血暂停后，需要继续执行，配置需要继续执行的条件。

![[Pasted image 20241213162605.png|L|900]]

如果配置了后者，则需要在扫描医嘱条码后，继续扫描患者腕带，才能继续执行输血。

![[Pasted image 20241213162500.png|L|600]]

### 输血巡视显示

* 输液、输血列表均展示：输液和输血均生成巡视数据
* 仅展示输液列表：输液生成巡视数据，输血不生成巡视数据
* 不生成输血/输液巡视记录：输液和输血均不生成巡视数据

### 巡视滴速配置

当执行输血巡视时，滴速的单位选项配置。

![[Pasted image 20241213163037.png|L|900]]

![[Pasted image 20241213163143.png|L|300]]

# 输血执行流程

## 流程配置

![[Pasted image 20241213164603.png|600]]

## 状态定义

### 输血节点

>状态定义：com.lachesis.windranger.mnis.contants.OrderProcessConstants.Node
>状态使用：com.lachesis.windranger.mnis.model.PatInhosOrderProcess#processNode

| 状态码           | 状态描述  |
| ------------- | ----- |
| blood_prepare | 备血    |
| blood_receive | 收取血袋  |
| blood_check   | 输血前核对 |
| blood_execute | 输血执行  |
| blood_inspect | 输血巡视  |
| blood_recover | 回收血袋  |
### 输血巡视状态

>状态定义：com.lachesis.windranger.mnis.contants.OrderProcessConstants.InfusionStatus
>状态使用：com.lachesis.windranger.mnis.model.PatInhosBloodMonitor#infuStatus

| 状态码 | 状态描述     | 备注                                          |
| --- | -------- | ------------------------------------------- |
| A   | 输血前-巡视   |                                             |
| T   | 输血执行时-巡视 |                                             |
| I   | 执行中-巡视   | I和T的区别是？T是点击输血执行时（那个时间点）添加的巡视信息，I是在执行中的巡视信息 |
| P   | 暂停       |                                             |
| S   | 终止       |                                             |
| F   | 完成       |                                             |
| B   | 输血后巡视    |                                             |
### 输血执行状态

>状态定义：com.lachesis.windranger.mnis.contants.OrderProcessConstants.BloodStatus
>状态使用：com.lachesis.windranger.mnis.model.PatInhosBloodExecute#executeStatus

| 状态码 | 状态描述 |
| --- | ---- |
| 0   | 收血   |
| 1   | 已核对  |
| 2   | 执行中  |
| 3   | 执行完成 |
### 输血医嘱状态

>状态定义：com.lachesis.windranger.mnis.contants.OrderProcessConstants.Status#EXECUTING
>状态使用：com.lachesis.windranger.emr.model.PatEmrBloodTransfusion#executeStatus

| 状态码 | 状态描述 |
| --- | ---- |
| 0   | 未执行  |
| 1   | 执行中  |
| 2   | 执行完成 |
| 4   | 废弃   |

## 备血
## 收取→核对→执行→巡视→回收

![[Pasted image 20241213182104.png|L|900]]

## 血袋回收

收血状态

* recover
* un_recover

# 数据结构

* 献血码：windranger_emr.pat_emr_blood_transfusion blood_donation_code `=0220322046209`
* 产品码：windranger_emr.pat_emr_blood_transfusion blood_product_code  `=<P3147V00`

# 执行记录

示例

* @ 收取血袋                   --- 李/左羽                                     <font color="#f79646">blood_receive</font>
	* 2024-05-21 16:27
* @ 输血前核对                 --- 李/左羽                                     <font color="#f79646">blood_check</font>，核对的时候会调用两个接口 /WRMSMnis/blood/check /WRMSMnis/blood/patrol/pre
	* 2024-05-21 16:29
* @ 输血前巡视                 --- 李
	* 体温：36°C
	* 2024-05-21 16:29
* @ 输血执行                   --- 李/左羽                                     <font color="#f79646">blood_execute</font>
	* 体温：36°C，脉搏：80次/分
	* 2024-05-21 16:41
* @ 巡视                       --- 李
	* 滴速：10ml/分
	* 体温：39°C
	* 2024-05-21 16:44
* @ 巡视                       --- 李
	* 滴速：20ml/分
	* 血压：100/mmhg
	* 2024-05-21 16:44
* @ 暂停：发热反应             --- 李
	* 2024-05-21 16:56
* @ 巡视                       --- 李 继续扫描患者腕带后继续输血的记录
	* 2024-05-21 16:58
* ! 终止后尽然不能再看到之前的流程，然后直接跳转到回收节点

# 测试
## 数据准备与恢复

### 不含备血

```sql
-- inhosCode=12295451
-- 谢玉家tsj
-- 消化内科
select * from windranger_emr.pat_emr_blood_transfusion where blood_transfusion_code in ('2414');
-- 患者腕带条码 BR|1133443|12295451
select * from windranger_emr.pat_inhos_record where inhos_code='12295451';

-- 需要扫描献血码和产品码
select blood_donation_code, blood_product_code from windranger_emr.pat_emr_blood_transfusion where inhos_code = '12295451' and blood_transfusion_code in ('2414');

-- 恢复数据
UPDATE windranger_emr.pat_emr_blood_transfusion SET execute_status=0, execute_time=NULL, execute_person=NULL WHERE blood_transfusion_code IN ('2414');
-- 数据恢复--医嘱进程
DELETE FROM windranger_mnis.pat_inhos_order_process WHERE inhos_code='12295451' AND order_bar IN ('2414');
-- 数据恢复--输血执行
DELETE FROM windranger_mnis.pat_inhos_blood_execute WHERE blood_transfusion_code IN ('2414');
-- 数据恢复--巡视
DELETE FROM windranger_mnis.pat_inhos_blood_monitor WHERE blood_transfusion_code IN  ('2414');
```

### 含备血

```sql
-- 1.患者信息 - 准备患者条码: BR|1133443|12295451
SELECT * FROM windranger_emr.pat_inhos_record WHERE inhos_code = '12295451';

-- 2.寻找合适的检验数据
-- 前提：1.requested_date_time必须是两天内
SELECT * FROM windranger_emr.pat_lab_master WHERE inhos_code = '12295451' order by requested_date_time desc;

-- 3.将检验数据与备血单关联
-- 前提：blood_apply_date 必须否和筛选范围，一般为列表选定日期当天
SELECT * FROM windranger_emr.pat_emr_blood_prepare WHERE inhos_code = '12295451';

-- 4.将备血单与输血单关联
SELECT * FROM windranger_emr.pat_emr_blood_transfusion WHERE apply_dept_code = '309' AND inhos_code = '12295451' and blood_apply_code = '543';
```

```sql
# 重置备血数据  
select * from windranger_emr.pat_emr_blood_prepare where inhos_code = '12295451' and blood_apply_code in ('404');  
update windranger_emr.pat_emr_blood_prepare set prepare_status = 0 WHERE inhos_code = '12295451' and blood_apply_code in ('404');  
# 重置检验数据 
select * from windranger_emr.pat_lab_master where inhos_code = '12295451' and bar_code in ('122050581599');  
select execute_status,execute_person,execute_time from windranger_emr.pat_lab_master where inhos_code = '12295451' and bar_code in ('122050581599');  
update windranger_emr.pat_lab_master set execute_time = null,execute_person=null,execute_status=0 WHERE inhos_code = '12295451' and bar_code in ('122050581599');  
# 删除绑定关系  
select * from windranger_emr.pat_emr_blood_prepare_record where inhos_code = '12295451' and blood_apply_code = '404' and lab_bar_code = '122050581599';  
delete from windranger_emr.pat_emr_blood_prepare_record where inhos_code = '12295451' and blood_apply_code = '404' and lab_bar_code = '122050581599';  
# 输血备血节点  
select * from windranger_mnis.pat_inhos_order_process where inhos_code = '12295451' and order_bar in ('1895');  # 注意这里是输血码即 pat_emr_blood_transfusion.blood_transfusion_code
delete from windranger_mnis.pat_inhos_order_process where inhos_code = '12295451' and order_bar in ('1895');    # 注意这里是输血码即 pat_emr_blood_transfusion.blood_transfusion_code  
# 绑定检验节点  
select * from windranger_mnis.pat_inhos_order_process where inhos_code = '12295451' and order_bar in ('122050581599');  
delete from windranger_mnis.pat_inhos_order_process where inhos_code = '12295451' and order_bar in ('122050581599');
```

>只删除备血执行相关的数据

```sql
# 重置备血数据  
select * from windranger_emr.pat_emr_blood_prepare where inhos_code = '12295451' and blood_apply_code in ('404');                   # 备血申请单号
update windranger_emr.pat_emr_blood_prepare set prepare_status = 0 WHERE inhos_code = '12295451' and blood_apply_code in ('404');   # 备血申请单号  
# 重置检验数据 
select * from windranger_emr.pat_lab_master where inhos_code = '12295451' and bar_code in ('122050581599');                         # 备血采集时对应的检验医嘱条码  
select execute_status,execute_person,execute_time from windranger_emr.pat_lab_master where inhos_code = '12295451' and bar_code in ('122050581599');  
update windranger_emr.pat_lab_master set execute_time = null,execute_person=null,execute_status=0 WHERE inhos_code = '12295451' and bar_code in ('122050581599');  # 这里的order_bar备血采集时对应的检验医嘱条码（即pat_lab_master表的bar_code字段） 
# 删除绑定关系  
select * from windranger_emr.pat_emr_blood_prepare_record where inhos_code = '12295451' and blood_apply_code = '404' and lab_bar_code = '122050581599';   # 解除备血申请单号与备血采集时对应的检验医嘱条码的绑定关系
delete from windranger_emr.pat_emr_blood_prepare_record where inhos_code = '12295451' and blood_apply_code = '404' and lab_bar_code = '122050581599';  
# 输血备血节点(这里只删除备血节点)  
select * from windranger_mnis.pat_inhos_order_process where inhos_code = '12295451' and order_bar in ('1895') and process_node = 'blood_prepare';  # 这里的order_bar是输血码（即pat_emr_blood_transfusion.blood_transfusion_code字段）
delete from windranger_mnis.pat_inhos_order_process where inhos_code = '12295451' and order_bar in ('1895') and process_node = 'blood_prepare';    # 这里的order_bar是输血码（即pat_emr_blood_transfusion.blood_transfusion_code字段 ） 
# 绑定检验节点  
select * from windranger_mnis.pat_inhos_order_process where inhos_code = '12295451' and order_bar in ('122050581599'); # 这里的order_bar备血采集时对应的检验医嘱条码（即pat_lab_master表的bar_code字段） 
delete from windranger_mnis.pat_inhos_order_process where inhos_code = '12295451' and order_bar in ('122050581599');   # 这里的order_bar备血采集时对应的检验医嘱条码（即pat_lab_master表的bar_code字段） 
```


>申请单与检验绑定关系

```sql
select * from pat_emr_blood_prepare_lab_rel where inhos_code = '12295451';
```

| seq\_id | unique\_code                | inhos\_code | pat\_code | blood\_apply\_code | lab\_bar\_code |
| :------ | :-------------------------- | :---------- | :-------- | :----------------- | :------------- |
| 1       | 12295451\_543\_122050581599 | 12295451    | 1133443   | 543                | 122050581599   |
| 2       | 12295451\_543\_122051202733 | 12295451    | 1133443   | 543                | 122051202733   |

## 备血【可选】

### 备血列表

2

查询患者备血列表（调用 `/WRMSMnis/blood/prepare/list` 接口）

* 初始化备血数据 startDate >= 昨天00:00:00点
* 获取备血列表

<font color="#f79646">1.初始化备血数据</font>

```json
// POST /WRMSMnis/blood/prepare/list
{
    "allWard": 1,
    "wardCode": "309",
    "startDate": "2024-06-24 00:00:00",
    "endDate": "2024-06-24 23:59:59"
}

// 初始化时 当前时间 2024-06-25 16:15:00
// startDate = 2024-06-24 00:00:00
// endDate   = 2024-06-26 00:00:00
```

> [!tips]- 响应结果
> 
> ```json
> {
>   "code": 1001,
>   "msg": "成功",
>   "data": [
>     {
>       "wardCode": "309",
>       "wardName": "消化内科",
>       "deptCode": null,
>       "deptName": null,
>       "inhosCode": "12338450",
>       "patName": "陆周清",
>       "patCode": "886406",
>       "displayCode": "886406",
>       "bedCode": "102免f",
>       "interceptBedCode": "102免f",
>       "age": "66岁",
>       "gender": "M",
>       "inDiag": "1、食管胃底静脉曲张破裂出血1",
>       "executeStatus": false,
>       "executeTime": null,
>       "bloodType": null,
>       "bloodRh": null,
>       "bloodApplyCode": "404",
>       "isDoubleCheck": false,
>       "nodeInfo": null,
>       "items": [
>         {
>           "bloodApplyCode": "404",
>           "bloodTransfusionCode": "1895",
>           "planTime": "2022-05-10 01:16:00",
>           "bloodComponentType": "去白悬浮红细胞",
>           "bloodQuantity": "2.00",
>           "bloodUnit": "U"
>         }
>       ],
>       "labItems": []
>     },
>     {
>       "wardCode": "309",
>       "wardName": "消化内科",
>       "deptCode": null,
>       "deptName": null,
>       "inhosCode": "12338450",
>       "patName": "陆周清",
>       "patCode": "886406",
>       "displayCode": "886406",
>       "bedCode": "102免f",
>       "interceptBedCode": "102免f",
>       "age": "66岁",
>       "gender": "M",
>       "inDiag": "1、食管胃底静脉曲张破裂出血1",
>       "executeStatus": false,
>       "executeTime": null,
>       "bloodType": "A",
>       "bloodRh": "+",
>       "bloodApplyCode": "427",
>       "isDoubleCheck": false,
>       "nodeInfo": null,
>       "items": [
>         {
>           "bloodApplyCode": "427",
>           "bloodTransfusionCode": "1924",
>           "planTime": "2022-05-10 01:16:00",
>           "bloodComponentType": "普通冰冻血浆",
>           "bloodQuantity": "220.00",
>           "bloodUnit": "ML"
>         }
>       ],
>       "labItems": []
>     }
>   ]
> }
> ```

<font color="#f79646">2.查询备血列表</font>

列表页展示数据的核心逻辑

```sql
-- 1.列表展示的输血数据
select * from windranger_emr.pat_emr_blood_transfusion where execute_status !='4'
and inhos_code is not null
and apply_dept_code = '309'
and blood_apply_date >= '2024-06-24 00:00:00' and blood_apply_date < '2024-06-26 00:00:00'
and inhos_code in (select inhos_code from windranger_emr.pat_inhos_record where status = 1 and ward_code = '309');

-- 2.查询第1步备血采集数据
select * from windranger_emr.pat_emr_blood_prepare_record where blood_apply_code in (  
select blood_apply_code from windranger_emr.pat_emr_blood_transfusion where execute_status !='4'  
and inhos_code is not null  
and apply_dept_code = '309'  
and blood_apply_date >= '2024-06-24 00:00:00' and blood_apply_date < '2024-06-26 00:00:00'  
and inhos_code in (select inhos_code from windranger_emr.pat_inhos_record where status = 1 and ward_code = '309'));

-- 3.查询第2步备血采集绑定的检验数据
select * from windranger_emr.pat_lab_master where bar_code in (  
select lab_bar_code from windranger_emr.pat_emr_blood_prepare_record where blood_apply_code in (  
select blood_apply_code from windranger_emr.pat_emr_blood_transfusion where execute_status !='4'  
and inhos_code is not null  
and apply_dept_code = '309'  
and blood_apply_date >= '2024-06-24 00:00:00' and blood_apply_date < '2024-06-26 00:00:00'  
and inhos_code in (select inhos_code from windranger_emr.pat_inhos_record where status = 1 and ward_code = '309')));
```


### 备血检验扫码 **检验条码**

```json
// POST /WRMSMnis/blood/prepare/scan
// params: inhosCode=12295451	barCode=122051097049 备血采集绑定的检验条码
// windranger_emr.pat_lab_master.bar_code
// windranger_emr.pat_emr_blood_prepare_record.lab_bar_code 备血采集绑定的检验条码字段 
```

### 采集开始 **患者腕带+检验条码**

> [!note] 开始之前需要扫描<font color="#ff0000">患者腕带</font>和<font color="#ff0000">检验条码</font>

>1.初次绑定

![[c11e3304-46ff-47e4-933a-cf997e7adedc.jpg|L|400]]

>2.采集取消后重新绑定并操作完开始采集后的页面（重新请求了一次备血列表接口）

![[9d708216-a515-46b5-a175-67c90ae9f433.jpg|L|400]]

```json
// POST /WRMSMnis/blood/prepare/collect/start
{
    "wardCode": "309",
    "inhosCode": "12295451",
    "bloodApplyCode": "543",
    "executeItems": [
        {
            "orderBar": "122051097049"  // 备血采集绑定的检验条码
        }
    ]
}
```

```sql
SELECT * FROM windranger_emr.pat_emr_blood_transfusion WHERE apply_dept_code = '309' AND inhos_code = '12295451' and blood_apply_code = '543';


select * from windranger_mnis.pat_inhos_order_process 
WHERE inhos_code = '12295451'
AND order_bar IN (SELECT blood_transfusion_code FROM windranger_emr.pat_emr_blood_transfusion WHERE apply_dept_code = '309' AND inhos_code = '12295451' and blood_apply_code = '543');

delete from windranger_mnis.pat_inhos_order_process 
WHERE inhos_code = '12295451'
AND order_bar IN (SELECT blood_transfusion_code FROM windranger_emr.pat_emr_blood_transfusion WHERE apply_dept_code = '309' AND inhos_code = '12295451' and blood_apply_code = '543');
```

### 采集返回

> [!danger] 注意
> 采集开始之后，点击右上角弹窗，点击「确定」表示采集返回，点击「取消」不进行任何操作！
> 采集返回 = 放弃采集，数据状态回退到开始采集之前！

![[be787835-66ce-4341-8085-3bccc1abc1e2.jpg|L|400]]

```json
// POST /WRMSMnis/blood/prepare/collect/back
// params: inhosCode=12295451	applyCode=543
```

### 采集取消 **检验条码**

>[!danger] 注意
>采集开始之后，再扫描一次检验条码，点击「确定」表示采集取消，点击「取消」不进行任何操作！
>采集取消 != 采集返回，备血数据状态回退到开始采集之前，检验条码不能再绑定！

![[be787835-66ce-4341-8085-3bccc1abc1e2.jpg|L|400]]

> [!tip] 提示
> 采集取消和采集返回的页面是一样的~

```json
// POST /WRMSMnis/blood/prepare/collect/cancel
// params: inhosCode=12295451	applyCode=543	barCode=
```

![[Pasted image 20240809154712.png|L|400]]

### 采集结束

>结束前

![[9d708216-a515-46b5-a175-67c90ae9f433.jpg|L|400]]

>结束后

![[f81a5b3c-d8a8-4a7e-b573-8bd1dc939948.jpg|L|400]]

```json
// POST /WRMSMnis/blood/prepare/collect/finish

```

## 收取血袋 **【献血码+产品码】或【输血条码】**

### 扫码接口



![[Pasted image 20241213151755.png|L|400]]

相关逻辑：

* 先进行双人核对（调用`/WRMSMnis/orderValidate/double/check`接口）*【可选】配置了双人核对的前提下*
* 再执行收血（调用`/WRMSMnis/blood/receive`接口）

1.双人核对

```json
// GET /WRMSMnis/orderValidate/double/check?
wardCode=309&
checkUserCode=8099&
checkPassword=123
```

2.收血

```json
// POST /WRMSMnis/blood/receive

[
    {
        "wardCode": "309",
        "patCode": "1133443",
        "inhosCode": "12295451",
        "bloodTransfusionCode": "2414",
        "bloodApplyCode": "543",
        "processNode": "blood_receive",
        "processId": "6669486d45dd723277fad39e",
        "checkNurse": "8099"
    }
]
```

## 输血前核对 **【献血码+产品码】或【输血条码】**

![[Pasted image 20241213151906.png|L|400]]

相关逻辑：

* 双人核对（调用`/WRMSMnis/orderValidate/double/check`接口）*【可选】配置了双人核对的前提下*
* 血袋核对（调用`/WRMSMnis/blood/check`接口）
* 输血前巡视（调用`/WRMSMnis/blood/patrol/pre`接口）

1.双人核对

```json
// GET /WRMSMnis/orderValidate/double/check?
wardCode=309&
checkUserCode=8099&
checkPassword=123
```

2.血袋核对

```json
// POST /WRMSMnis/blood/check
{
	"wardCode": "309",
	"patCode": "1133443",
	"inhosCode": "12295451",
	"bloodTransfusionCode": "2414",
	"bloodApplyCode": "543",
	"processNode": "blood_check",
	"processId": "6669486d45dd723277fad39e",
	"checkNurse": "8099"
}
```

3.输血前巡视

```json
// POST /WRMSMnis/blood/patrol/pre
{
	"checkNurse": "8099",
	"isSync": 0,
	"seqId": 1248,
	"inhosCode": "12295451",
	"wardCode": "309",
	"infuMonitorCode": "24061716461",
	"bloodTransfusionCode": "2414",
	"monitorDatetime": 1718765164077,
	"monitorNurseCode": "123",
	"monitorNurseName": "李",
	"abnormal": 0,
	"temperature": "",
	"pulse": "",
	"pressure": "",
	"breath": "",
	"infuStatus": "A",
	"createTime": 1718765164105,
	"createPerson": "123",
	"primaryKey": 1248
}
```

### 输血前核对回写

```json
{
    "type": "BloodCheck",
    "resultList": [
        {
            "bloodEffectiveTime": 2187676986000,
            "bloodUnit": "ML",
            "patName": "谢玉家",
            "recyclePersonName": "",
            "executeEndPersonName": "",
            "bedCode": "10236",
            "bloodRequirementState": "05",
            "wardCode": "309",
            "bloodComponentType": "新鲜冰冻血浆1-关联医嘱-无滴速",
            "bloodApplyDate": 1739499720000,
            "executeStatus": 1,
            "bloodCheckPerson": "123",
            "inhosCode": "12295451",
            "bloodUseDate": 1739499840000,
            "bloodCheckPersonName": "李",
            "bloodTransfusionCode": "2414",
            "bloodQuantity": "230.00",
            "patBloodType": "B",
            "bloodDonationCode": "=0220322046209",
            "remark": "123",
            "bloodType": "B",
            "receivePerson": "123",
            "executePersonName": "",
            "bloodPurpose": "05",
            "patDiagonsis": "酒精性肝硬化 失代偿期",
            "checkNurseName": "左羽",
            "checkNurse": "8099",
            "seqId": 794,
            "bloodApplyCode": "543",
            "bloodProductCode": "=<P3147V00",
            "applyDeptCode": "309",
            "patSex": "男",
            "createPerson": "123",
            "receivePersonName": "李",
            "updateTime": 1741154223456,
            "finishPersonName": "",
            "bloodRh": "+",
            "patCode": "1133443",
            "applyDeptName": "消化内科",
            "createTime": 1740560531000,
            "patAge": "89岁",
            "patRhType": "+",
            "finishDate": 1741154223590,
            "bloodCompTypeCode": "21",
            "updatePerson": "123",
            "receivePersonHisCode": "123",
            "checkNurseHisCode": "8099",
            "bloodCheckPersonHisCode": "123"
        }
    ]
}
```

## 输血执行 **患者腕带**


![[Pasted image 20241213151027.png|L|400]]

相关逻辑：

* 双人核对（调用`/WRMSMnis/orderValidate/double/check`接口）*【可选】配置了双人核对的前提下*
* 输血执行（调用`/WRMSMnis/blood/execute`接口）
* 文书同步

1.双人核对

```json
// GET /WRMSMnis/orderValidate/double/check?
wardCode=309&
checkUserCode=8099&
checkPassword=123
```

2.输血执行

```json
// POST /WRMSMnis/blood/execute
{
	"monitor": {
		"abnormal": 0,
		"bloodTransfusionCode": "2414",
		"breath": "",
		"infuStatus": "T",
		"inhosCode": "12295451",
		"isSync": 0,
		"monitorNurseCode": "123",
		"monitorNurseName": "李",
		"pressure": "",
		"pulse": "",
		"speedUnit": "ml/分",
		"temperature": "36",
		"wardCode": "309"
	},
	"executeVo": {
		"bloodApplyCode": "543",
		"bloodTransfusionCode": "2414",
		"checkNurse": "左羽",
		"inhosCode": "12295451",
		"patCode": "1133443",
		"processId": "6669486d45dd723277fad39e",
		"processNode": "blood_execute",
		"wardCode": "309"
	}
}
```

### 输血执行回写

```json

```

## 输血巡视 **【献血码+产品码】或【输血条码】**

### 正常巡视

![[Pasted image 20241213153940.png|L|400]]

```json
// POST /WRMSMnis/blood/patrol
{
	"isSync": 0,
	"seqId": 1250,
	"inhosCode": "12295451",
	"wardCode": "309",
	"infuMonitorCode": "24061716463",
	"bloodTransfusionCode": "2414",
	"monitorDatetime": 1718766090344,
	"monitorNurseCode": "123",
	"monitorNurseName": "李",
	"abnormal": 0,
	"dropSpeed": 10,
	"temperature": "",
	"pulse": "",
	"pressure": "",
	"breath": "",
	"infuStatus": "I",          // 执行中-巡视
	"speedUnit": "ml/分",
	"createTime": 1718766090344,
	"createPerson": "123",
	"adverseReaction": "",
	"adverseReactionType": "",
	"adverseReactionStartTime": 1718766060000,
	"primaryKey": 1250
}
```

### 正常完成

```json
// POST /WRMSMnis/blood/patrol
{
	"checkNurse": "8099",
	"isSync": 0,
	"seqId": 1247,
	"inhosCode": "12295451",
	"wardCode": "309",
	"infuMonitorCode": "24061716460",
	"bloodTransfusionCode": "2414",
	"monitorDatetime": 1718764459425,
	"monitorNurseCode": "123",
	"monitorNurseName": "李",
	"abnormal": 0,
	"temperature": "",
	"pulse": "",
	"pressure": "",
	"breath": "",
	"infuStatus": "F",          // 完成，同时也会结束输血
	"statusDescription": "封管",
	"speedUnit": "ml/分",
	"recordTime": "end",
	"createTime": 1718764459425,
	"createPerson": "123",
	"adverseReaction": "",
	"adverseReactionType": "",
	"adverseReactionStartTime": 1718764320000,
	"primaryKey": 1247
}
```

### 暂停

![[Pasted image 20241213154627.png|L|400]]

```json
// POST /WRMSMnis/blood/patrol
{
	"seqId": 1251,
	"inhosCode": "12295451",
	"wardCode": "309",
	"infuMonitorCode": "24061716464",
	"bloodTransfusionCode": "2414",
	"monitorDatetime": 1718766222858,
	"monitorNurseCode": "123",
	"monitorNurseName": "李",
	"abnormal": 1,
	"abnormalMsg": "压力过低",
	"infuStatus": "P",          // 暂停
	"createTime": 1718766222858,
	"createPerson": "123",
	"primaryKey": 1251
}
```

### 暂停后继续输血


```json
// POST /WRMSMnis/blood/patrol
{
	"seqId": 1252,
	"inhosCode": "12295451",
	"wardCode": "309",
	"infuMonitorCode": "24061716465",
	"bloodTransfusionCode": "2414",
	"monitorDatetime": 1718766423253,
	"monitorNurseCode": "123",
	"monitorNurseName": "李",
	"abnormal": 0,
	"infuStatus": "I",          // 执行中-巡视
	"createTime": 1718766423253,
	"createPerson": "123",
	"primaryKey": 1252
}
```

### 暂停后终止输血

暂停后终止输血必须输入<font color="#f79646">终止原因</font>和<font color="#f79646">余量</font>~

```json
// POST /WRMSMnis/blood/patrol
{
	"seqId": 1254,
	"inhosCode": "12295451",
	"wardCode": "309",
	"infuMonitorCode": "24061716467",
	"bloodTransfusionCode": "2414",
	"monitorDatetime": 1718766581337,
	"monitorNurseCode": "123",
	"monitorNurseName": "李",
	"abnormal": 1,
	"abnormalMsg": "发热反应",
	"residue": 10,
	"temperature": "",
	"pulse": "",
	"pressure": "",
	"breath": "",
	"infuStatus": "S",          // 终止
	"unit": "ML",
	"recordTime": "end",
	"createTime": 1718766581337,
	"createPerson": "123",
	"primaryKey": 1254
}
```

## 回收血袋

![[Pasted image 20241213161828.png|L|400]]

相关逻辑：

* 先进行双人核对（调用`/WRMSMnis/orderValidate/double/check`接口）
* 再回收血袋（调用`/WRMSMnis/blood/recycle`接口）

1.双人核对

```json
// GET /WRMSMnis/orderValidate/double/check?
wardCode=309&
checkUserCode=8099&
checkPassword=123
```

2.回收血袋

```json
// POST /WRMSMnis/blood/recycle

[
	{
		"wardCode": "309",
		"patCode": "1133443",
		"inhosCode": "12295451",
		"bloodTransfusionCode": "2414",
		"bloodApplyCode": "543",
		"processNode": "blood_recover",
		"processId": "6669486d45dd723277fad39e",
		"checkNurse": "8099"
	}
]
```

## 输血后巡视

* ! 输血后巡视，可以在回收血袋之前或之后，只要在输血完成之后就行~
* ! 输血后巡视操作入口：输血后巡视

![[Pasted image 20241213174539.png|1100]]




