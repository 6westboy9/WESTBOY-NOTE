# 文书模板信息


## 文书分类/类型

> [!danger] 注意
> - 文书 = 护理文书
> - 文书分类 = 文书模板类型

>170环境文书模板类型核心字段

页面入口：<font color="#9bbb59">实施配置 - 文书类型管理</font>

><font color="#f79646">新增/修改时不能设置类型编号！</font>

![[Pasted image 20240523173704.png|L|1200]]

```sql
select * from windranger_mnis.doc_template_type where enable_status = 1;
```

| doc\_type\_code | doc\_type\_name | sort\_no |
| :--- | :--- | :--- |
| D000011 | 护理评估与计划 | 1 |
| D000009 | 护理记录单 | 2 |
| D000007 | 产科表单 | 3 |
| D000002 | 产科表单 | 3 |
| D000003 | 儿科新生儿 | 4 |
| D000004 | PICC表单 | 5 |
| D000012 | 健康教育信息 | 6 |
| D000005 | 平台专用类 | 8 |
| D000013 | 知情告知信息 | 8 |
| D000034 | 护理会诊 | 13 |
| D000035 | 健康宣教 | 14 |
| D000006 | 评估单 | 15 |
| D000014 | 常用文书 | 16 |
| D000001 | 风险评估单 | 17 |

## 报表类型

>来源：com.lachesis.windranger.doc.enums.DocReportTypeEnum

``` java
public enum DocReportTypeEnum {
	NURSING("nursingDoc", "护理记录单"),     // 护理记录 - MySQL 
	EVALUATE("evaluateDoc", "风险评估单"),   // 护理评估/风险评估 - MySQL
	DELIVER("childBirthDoc", "分娩记录单"),  // 分娩记录（需要进行配置后，才会在配置文书模板时，报表类型下拉选项才会显示）- MongoDB
	LINA("linaDoc", "lina文书"),            // Lina文书（在配置文书模板时不会显示）- MongoDB
	NORMAL("normalDoc", "普通文书");         // 普通文书 - MySQL
}
```

>文书分类和报表类型是完全独立的两个类型，两者之间没有必然的关联关系~

特别说明，经常看到同事将文书分为以下四类：

1. 护理记录
2. 风险评估
3. 普通文书
4. Lina文书

说明

1. 以上文书统称为三大文书和Lina文书，后者是通过低代码的方式实现的，数据结构和渲染方式与前者有所不同。
2. 以上文书分类不是业务上的分类，而是单纯从需求场景和前端组件实现上来区分的，业务上有些文书名字是评估单，但可能实际是普通文书实现。

><font color="#f79646">所有报表类型</font>

* 护理记录 → nursingDoc
	* 普通护理单
	* 血糖单
	* 产程图
	* 临产记录单
* 护理评估/风险评估 → evaluateDoc
* 普通文书 → normalDoc
	* 普通文书
	* 会诊单
* Lina文书 → linaDoc
	* 注意Lina文书也是报表类型的，对于Lina文书存储在模板信息表中的报表类型固定为linaDoc

> [!question] 遗留问题：如何判断子类型呢？比如血糖单、产程图？

### 护理记录

![[Pasted image 20240607135051.png|L|1200]]

* 主体：表头（<font color="#c0504d">一个表头类似于Excel中的一个Sheet页</font>）
* <font color="#c0504d">同一患者的同一护理记录模板对应的所有表头共用一个document_code</font>
* 一个表头对应一个header_code
* 一个表中一行数据对应一个record_code
* 具体每个表头的分页大小配置路径：<font color="#9bbb59">实施配置 - 模板信息 - 每页行数</font>
* 操作
	* 新增护理记录文书 → 患者添加文书
	* 新增表头
	* 切换表头

```SQL
select * from windranger_mnis.doc_data_nurse_header where inhos_code = '43017851' and template_code = 'T111116';
```

### 护理评估

![[Pasted image 20240607133420.png|L|1200]]

点击某一行后跳转录入页面

![[Pasted image 20240607133633.png|L|1200]]

* <font color="#c0504d">主体：页（与护理记录数据结构相同，这里的页也类似Excel中的一个Sheet页，页头相当于Sheet页的表头）</font>
* <font color="#c0504d">同一患者的同一风险评估模板对应的所有页共用一个document_code</font> 感觉与护记单类似~
* 每页对应不同的header_code（换页时会生产新的header_code），但是所有页的document_code是相同的（即对应同一份文书模板）
* 每页中表格的一行数据对应一个record_code
* 操作
	* 新增风险评估文书 → 操作入口：患者添加文书
	* 换页
	* 当前页新建 → 含义：新增一行记录
	* 切换页


```SQL
select * from windranger_mnis.doc_data_evaluate_header where inhos_code = '43017851' and template_code = 'T111110';
```

| ward\_code | inhos\_code | template\_code | document\_code | header\_code | header\_title | page\_no |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| 309 | 43017851 | T111110 | D00332586 | H00320719 | 新表头 | 1 |
| 309 | 43017851 | T111110 | D00332586 | H00320740 | null | 2 |
| 309 | 43017851 | T111110 | D00332586 | H00320747 | null | 3 |
| 309 | 43017851 | T111110 | D00332586 | H00320757 | null | 4 |
| 309 | 43017851 | T111110 | D00332586 | H00320817 | null | 5 |
| 309 | 43017851 | T111110 | D00332586 | H00321112 | null | 6 |
| 309 | 43017851 | T111110 | D00332586 | H00321122 | 新表头 | 7 |

### 普通文书

![[Pasted image 20240607135243.png|1200]]

* <font color="#c0504d">主体：份（与上面两种文书不同，份直接对应明细，没有Sheet页的概念，所以没有header_code的概念）</font>
* <font color="#c0504d">同一患者的同一普通文书模板，每一份为一个document_code，即每份document_code不一样（与上面两种不同）</font>
* <font color="#c0504d">每份document_code和record_code为一对一关系</font>（因为份直接对应的明细，所以中间表doc_data_ordinary_record中存储的document_code与record_code是一对一的关系）
* 操作
	* 新增普通文书 → 操作入口：患者添加文书
	* 新增一份
	* 切换不同份

查询患者某个普通文书对应的所有份数信息

```sql
select * from windranger_mnis.doc_data_ordinary where inhos_code = '43017851' and template_code = 'T000040';
```

| inhos\_code | ward\_code | template\_code | document\_code |
| :--- | :--- | :--- | :--- |
| 43017851 | 309 | T000040 | D00332732 |
| 43017851 | 309 | T000040 | D00332733 |
| 43017851 | 309 | T000040 | D00332734 |
```sql
select * from windranger_mnis.doc_data_ordinary_record where document_code in (
select document_code from windranger_mnis.doc_data_ordinary where inhos_code = '43017851' and template_code = 'T000040');
```

| inhos\_code | pat\_code | ward\_code | document\_code | template\_code | template\_name     | record\_code               |
| :---------- | :-------- | :--------- | :------------- | :------------- | :----------------- | :------------------------- |
| 43017851    | 43017851  | 309        | D00332732      | T000040        | 住院患者首次护理评估单\(中医科\) | 1813399672753098752-512833 |
| 43017851    | 43017851  | 309        | D00332733      | T000040        | 住院患者首次护理评估单\(中医科\) | 1813399706718572544-898554 |
| 43017851    | 43017851  | 309        | D00332734      | T000040        | 住院患者首次护理评估单\(中医科\) | 1813399740579188736-631170 |

### 小结

|      | inhos_code | template_code    | document_code                                      | header_code                                    | record_code                                                     |
| ---- | ---------- | ---------------- | -------------------------------------------------- | ---------------------------------------------- | --------------------------------------------------------------- |
| 护记单  | 基础         | 单个患者同一文书模板只能创建一个 | <font color="#f79646">多表头</font>共用同一个document_code | 不同<font color="#f79646">表头</font>不同header_code | 同一表头下的多行记录record_code不同                                         |
| 评估单  | 基础         | 单个患者同一文书模板只能创建一个 | <font color="#f79646">多页</font>共用同一个document_code  | 不同<font color="#f79646">页</font>不同header_code  | 同一页下的多行记录record_code不同                                          |
| 普通文书 | 基础         | 单个患者同一文书模板只能创建一个 | <font color="#f79646">不同份对应不同document_code</font>  | <font color="#c0504d">无此概念~</font>             | <font color="#f79646">document_code与record_code一一对应</font>，表示一份 |

![[05.文书_三大文书小结.excalidraw|L|600]]

## 默认文书

什么是默认文书？新增患者时，在文书管理-文书编辑时，在侧边栏默认显示的文书。

* <font color="#f79646">页面入口</font>：<font color="#9bbb59">业务设置 - 默认文书设置</font>
* <font color="#f79646">核心表</font>：windranger_mnis.doc_template_ward_default

```ad-important
注意：一般手动添加的文书，都会创建表头，但是默认文书不会创建表头，只是显示一个默认文书的名称。
```


## 打印模板

不同文书的打印模板存储数据结构是不一样的

* 护理记录（真实路径：文书模板编辑-界面配置）：windranger_mnis.doc_template_edit_layout --- MySQL
* 护理评估（真实路径：文书模板编辑-打印配置）：mnis.docEvaluatePrintConfig --- MongoDB
* 普通文书（真实路径：文书模板编辑-打印配置）：mnis.docOrdinaryPrintConfig --- MongoDB


# 其它

## 旧版-分娩记录单

>分娩记录单配置入口：<font color="#9bbb59">配置中心 - 移动护理 - 文书配置 - 分娩记录单配置</font>

>南宁二院在使用，后续已经排期替换为使用新版方式

![[Pasted image 20240705143312.png|L|500]]

>如何判断是分娩记录单？

根据文书类型编码判断，如果文书模板配置的类型与上述配置的类型编码一致，则认为是分娩记录单。

![[Pasted image 20240705143542.png|L|1200]]

![[Pasted image 20240705143535.png|L|1200]]

分娩记录单的配置情况来看，需要选择报表类型，而这里的报表类型只能是护理记录、风险评估、普通文书三大类型，<font color="#f79646">没有Lina文书类型</font>~

## 记录时间

在一些表中我们会看到有`recode_date`和`recording_date`字段，它们之间的区别是？

## 护记单根据记录时间找表头

### 规则1

>com.lachesis.windranger.doc.service.impl.DocDataNurseHeaderService#getDocHeaderByDate

### 规则2

>com.lachesis.windranger.mnis.component.commontask.task.autosync.HeaderCalculator#calculate

![[16.WORK/1.联新知识库/02.移动护理/附件/企业微信截图_17248233757650.png|1600]]


* 单个表头
	* 没得选
* 多个表头（3个表头，就有2的3次方=8种情况）
	1. 表1有记录 & 表2有记录 & 表3有记录
	2. 表1有记录 & 表2有记录 & <font color="#8064a2">表3没记录</font>
	3. 表1有记录 & <font color="#8064a2">表2没记录</font> & 表3有记录
	4. 表1有记录 & <font color="#8064a2">表2没记录</font> & <font color="#8064a2">表3没记录</font>
	5. <font color="#8064a2">表1没记录</font> & 表2有记录 & 表3有记录
	6. <font color="#8064a2">表1没记录</font> & 表2有记录 & <font color="#8064a2">表3没记录</font>
	7. <font color="#8064a2">表1没记录</font> & <font color="#8064a2">表2没记录</font> & 表3有记录
	8. <font color="#8064a2">表1没记录</font> & <font color="#8064a2">表2没记录</font> & <font color="#8064a2">表3没记录</font>

归纳：

* 表头按创建时间排序
* 规则1：所有表头均无记录，取最一个表头
* 根据体征记录时间recordDate查找表头范围（<font color="#f79646">前闭后开原则</font>）
	* 规则2：范围内的<font color="#c0504d">有记录</font>表头可以找到，取该表头
	* 没找到：
		* 规则3：无前驱<font color="#c0504d">有记录</font>表头，有后继<font color="#c0504d">有记录</font>表头：<font color="#9bbb59">取后继有记录表头前的第一个表头（默认取后继有记录表头，依次往前找）</font>
		* 规则4：有前驱<font color="#c0504d">有记录</font>表头，有后继<font color="#c0504d">有记录</font>表头：<font color="#9bbb59">取前驱有记录表头后的第一个表头（默认取前驱有记录表头，依次往后找）</font>
		* 规则5：有前驱<font color="#c0504d">有记录</font>表头，无后继<font color="#c0504d">有记录</font>表头：<font color="#9bbb59">取前驱有记录表头后的第一个表头（默认取前驱有记录表头，依次往后找）</font>






