# 1.CR  
  
>Java群  

项目：mnis  
内容：11189【河南科技大学第一附属医院（开元院区）】输血回收改造
分支：feat_release_mnis_v3.8_wpb_11189 into release_mnis_v3.8
MR：

# 2.脚本  
  
>邮件  
  
> [!danger] 注意事项  
> 提供脚本为实际线上脚本，所以必须考虑实际线上情况  
> 1.开关，默认应为关闭（根据实际情况而定）  
> 2.IP地址，默认应为127.0.0.1（一般情况）  
  
---  
  
宝哥麻烦归档下脚本：  
  
测试环境：10.2.3.170
项目：mnis
单号：11187
版本号：MNIS V3.8.161
分支：feat_release_mnis_v3.8_wpb_11187
  
MySQL脚本  
  
```sql
```  
  
  
> [!danger] 注意事项  
> 脚本后不要带 `;` ~  
  
MongDB脚本  
  
```js  
use coms

var collection = db.sysConfigFile;
var targetKey = 'orderExecutionConfig';
var childKey = 'bloodBagRecycleTimeCustomizable';

// 查找目标文档
var doc = collection.findOne({ 'key': targetKey });

if (doc) {
    // 检查 children 数组中是否已存在指定 key 的元素
    var exists = false;
    if (doc.children && doc.children.length > 0) {
        for (var i = 0; i < doc.children.length; i++) {
            if (doc.children[i].key === childKey) {
                exists = true;
                print('已存在 key 为 ' + childKey + ' 的元素，无需添加');
                break;
            }
        }
    }

    // 如果不存在，则添加新元素
    if (!exists) {
        collection.updateOne(
            { 'key': targetKey },
            {
                $push: {
                    'children': {
                        "_id": "65095ee1cf1fe2309d010848-Mon Dec 29 2025 14:32:17 GMT+0800",
                        "key": "bloodBagRecycleTimeCustomizable",
                        "pattern": {
                            "componentType": "Switch",
                            "label": "血袋回收时，支持自定义回收时间"
                        },
                        "value": false
                    }
                },
                $currentDate: {
                    'updateTime': true
                }
            }
        );
        print('成功添加 key 为 ' + childKey + ' 的元素');
    }
} else {
    print('未找到 key 为 ' + targetKey + ' 的文档');
}

use mnis

var collection = db.getCollection("mnisDocumentLinaTemplate");
var existingIndexes = collection.getIndexes();
var indexNames = existingIndexes.map(function(idx) { return idx.name; });

if (indexNames.indexOf("idx_templateCode") === -1) {
    collection.createIndex({ "templateCode": 1 }, {
        "name": "idx_templateCode"
    });
    print("索引 idx_templateCode 创建成功");
} else {
    print("索引 idx_templateCode 已存在，跳过创建");
}
```  
  
# 3.提测单  
  
>提测群


  
# 4.其它