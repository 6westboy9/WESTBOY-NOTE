# 1.CR  
  
>Java群  

项目：mnis
内容：
* 需求：11227【南昌市洪都中医院】-CA签名需要授权后替其他人签名
* 问题：38287【景德镇市昌南新区康养服务中心】-CA签名后保存的数据不对，保存的数据中没有签名结果，跟CA工程师沟通后发现我们调CA接口流程存在问题，需调整
分支：fix_release_mnis_v3.8_wpb_11227 into release_mnis_v3.8
MR：http://10.2.3.111:86/backend_group/backend_application/mnis/merge_requests/7874


测试注意：

1. 只改河北腾翔CA（其他CA厂商的不受影响）
2. 改动业务范围
	1. 目前只改了核心的文书CA签名场景，并验证签署成功，需要留意各种签名入口 ![[Pasted image 20260114144304.png|L|1400]]
	2. 质控（正常理解也是CA签名，但是只是拿到图片进行保存，并没有真正将质控的数据传递给CA厂商）

# 2.脚本  
  
>邮件  
  
> [!danger] 注意事项  
> 提供脚本为实际线上脚本，所以必须考虑实际线上情况  
> 1.开关，默认应为关闭（根据实际情况而定）  
> 2.IP地址，默认应为127.0.0.1（一般情况）  
  
---  
  
宝哥麻烦归档下脚本：  
  
测试环境：10.2.3.170  
项目：mnis
单号：11227  
版本号：MNIS V3.8.164
分支：fix_release_mnis_v3.8_wpb_11227
  
MySQL脚本  
  
```sql

```  
  
  
> [!danger] 注意事项  
> 脚本后不要带 `;` ~  
  
MongDB脚本  

```js
use mnis

/**
 * 通用索引创建方法
 * @param collectionName 集合名称
 * @param indexName 索引名称
 * @param indexFields 索引字段，如: { field1: 1, field2: -1 }
 * @param options 索引选项，可包含:
 *   - expireAfterSeconds: TTL 过期秒数（可选）
 *   - 其他 createIndex 支持的选项
 */
function createIndexIfNotExists(collectionName, indexName, indexFields, options) {
    options = options || {};
    options.name = indexName;  // 确保索引名称被设置

    var collection = db.getCollection(collectionName);
    var indexes = collection.getIndexes();
    var indexExists = false;

    // 检查索引是否已存在
    for (let i = 0; i < indexes.length; i++) {
        if (indexes[i].name === indexName) {
            indexExists = true;
            break;
        }
    }

    if (indexExists) {
        print("索引已存在, 无需创建: " + collectionName + "." + indexName);
    } else {
        print("索引不存在, 进行创建: " + collectionName + "." + indexName);
        collection.createIndex(indexFields, options);
        print("索引创建成功: " + indexName);
    }
}

// 1.创建 TTL 索引（7天过期，7*24*60*60 = 604800 秒）
createIndexIfNotExists(
    "caTransactionContextInfo",              // 集合名称
    "idx_cacheTime",                         // 索引名称
    { pointTime: 1 },                        // 索引字段
    { expireAfterSeconds: 604800 }           // 7天过期
);

//  2.创建普通升序索引
createIndexIfNotExists(
    "caTransactionContextInfo",              // 集合名称
    "idx_transactionId",                     // 索引名称
    { transactionId: 1 }                     // 索引字段
);
```


# 3.提测单  
  
>提测群  


# 4.其它
