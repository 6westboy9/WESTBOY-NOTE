# 1.CR

>Java群

项目: mnis
内容: 8063【南昌市洪都中医院】新增主诉数据同步至患者表
分支: feat_release_mnis_v3.8_wpb_8063 into qa_mnis_v3.8
MR: http://10.2.3.111:86/backend_group/backend_application/mnis/merge_requests/5236

项目: emr
内容: 8063【南昌市洪都中医院】新增主诉数据同步至患者表
分支: feat_release_mnis_v3.8_wpb_8063 into qa_mnis_v3.8
MR: http://10.2.3.111:86/backend_group/backend_application/emr/merge_requests/2479

# 2.脚本

>邮件

```ad-error
注意提供脚本为实际<font color="#9bbb59">上线脚本</font>！

注意配置相关的默认值
 1. 开关，默认应为关闭
 2. IP地址，默认应为127.0.0.1
```

---

宝哥麻烦归档下脚本：

测试环境：10.2.3.170
项目：mnis
服务：mnis
冲刺版本：移动护理迭代44
故事编号：8063
版本号：MNIS V3.8.98
分支：feat_release_mnis_v3.8_wpb_8063

MySQL脚本

```sql
-- 无
```


```ad-error
注意脚本后不要带 `;` ~
```

MongDB脚本

```js
// 新增患者关联项元素
use mnis
db.docDataSourceConfig.deleteOne({ 'sourceTable': 'patient', 'sourceColumn': 'situation' })
db.docDataSourceConfig.insertOne({
    "_class": "com.lachesis.windranger.doc.dbmodel.DocDataSourceConfig",
    "createPerson": "00850",
    "createTime": ISODate("2023-12-01T11:00:00.000+08:00"),
    "sourceColumn": "situation",
    "sourceColumnName": "主诉",
    "sourceTable": "patient",
    "sourceTableName": "患者"
})

// 请求发送数据给同步程序相关配置
use coms
db.sysConfigFile.update({ 'key': 'sendBackConfig' }, { "$pull": { 'children': { 'key': 'FirstComplaint' } } })
db.sysConfigFile.update({ 'key': 'sendBackConfig' }, {
    "$push": {
        "children":
            {
                "wardCode": "",
                "key": "FirstComplaint",
                "pattern": {
                    "componentType": "AddableTable",
                    "label": "主诉回写",
                    "optionKeyAttrs": [
                        {
                            "sortedIndex": 1,
                            "key": "enable",
                            "mapping": "name",
                            "componentType": "Input",
                            "editable": true,
                            "display": true,
                            "defaultValue": "false",
                            "title": "",
                            "prefix": "是否开启"
                        },
                        {
                            "sortedIndex": 2,
                            "key": "url",
                            "mapping": "name",
                            "componentType": "Input",
                            "editable": true,
                            "display": true,
                            "title": "",
                            "prefix": "请求地址"
                        },
                        {
                            "sortedIndex": 3,
                            "key": "type",
                            "mapping": "name",
                            "componentType": "Input",
                            "editable": true,
                            "display": true,
                            "prefix": "同步类型"
                        }
                    ]
                },
                "value": [
                    {
                        "sortedIndex": 1,
                        "enable": "false",
                        "url": "http://127.0.0.1:9098/data-sync/ReceiveMessage/typeJsonV2",
                        "type": ""
                    }
                ]
            }
    }
})
```

# 3.提测单

>提测群


http://10.2.3.109:1024/zentao/testtask-view-7658.html
8063【南昌市洪都中医院】新增主诉数据同步至患者表 --- 已提测

# 4.其它


如果之前线上使用患者表职业字段同步主诉数据，且在文书中展示主诉字段的情况，上线后需要修改：

1. 同步程序
	1. 患者同步字段映射：将原有存储主诉的字段occupation变更为situation
2. 移动护理
	1. 文书配置主诉关联项：职业 → 主诉




