
# 需求背景

Maven可以使用`mvn package`指令对项目进行打包，如果使用`java -jar xxx.jar`执行运行jar文件，会出现`no main manifest attribute, in xxx.jar`（没有设置Main-Class）、`ClassNotFoundException`（找不到依赖包）等错误。要想jar包能直接通过`java -jar xxx.jar`运行，需要满足：

1. 在jar包中的`META-INF/MANIFEST.MF`中指定Main-Class，这样才能确定程序的入口在哪里；
2. 要能加载到依赖包。

使用Maven有以下几种方法可以生成能直接运行的jar包，可以根据需要选择一种合适的方法。

# 实现方式
## 1.maven-jar-plugin&maven-dependency-plugin

```xml
<build>
    <plugins>
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-jar-plugin</artifactId>
            <version>2.6</version>
            <configuration>
                <archive>
                    <manifest>
                        <addClasspath>true</addClasspath>
                        <classpathPrefix>lib/</classpathPrefix>
                        <mainClass>com.xxg.Main</mainClass>
                    </manifest>
                </archive>
            </configuration>
        </plugin>
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-dependency-plugin</artifactId>
            <version>2.10</version>
            <executions>
                <execution>
                    <id>copy-dependencies</id>
                    <phase>package</phase>
                    <goals>
                        <goal>copy-dependencies</goal>
                    </goals>
                    <configuration>
                        <outputDirectory>${project.build.directory}/lib</outputDirectory>
                    </configuration>
                </execution>
            </executions>
        </plugin>
    </plugins>
</build>
```

maven-jar-plugin用于生成`META-INF/MANIFEST.MF`文件的部分内容。

* `<mainClass>com.xxg.Main</mainClass>`指定MANIFEST.MF中的Main-Class；
* `<addClasspath>true</addClasspath>`会在MANIFEST.MF加上Class-Path项并配置依赖包；
* `<classpathPrefix>lib/</classpathPrefix>`指定依赖包所在目录。

例如下面是一个通过maven-jar-plugin插件生成的MANIFEST.MF文件片段：

```
TODO
```

只是生成MANIFEST.MF文件还不够，maven-dependency-plugin插件用于将依赖包拷贝到`<outputDirectory>${project.build.directory}/lib</outputDirectory>`指定的位置，即lib目录下。

配置完成后，通过mvn package指令打包，会在target目录下生成jar包，并将依赖包拷贝到target/lib目录下，目录结构如下：

```
TODO
```

指定了Main-Class，有了依赖包，那么就可以直接通过java -jar xxx.jar运行jar包。

>这种方式生成jar包有个缺点，就是生成的jar包太多不便于管理，下面两种方式只生成一个jar文件，包含项目本身的代码、资源以及所有的依赖包。

## 2.maven-assembly-plugin


不指定Main-CLass情况

```xml
<build>
    <plugins>
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-assembly-plugin</artifactId>
            <version>3.3.0</version>
            <configuration>
                <descriptorRefs>
                    <descriptorRef>jar-with-dependencies</descriptorRef>
                </descriptorRefs>
            </configuration>
            <executions>
                <execution>
                    <id>make-assembly</id>
                    <phase>package</phase>
                    <goals>
                        <goal>single</goal>
                    </goals>
                </execution>
            </executions>
        </plugin>
    </plugins>
</build>
```


## 3.maven-shade-plugin


# 参考资料


* https://blog.csdn.net/lixiangchibang/article/details/123797831
* [Maven打包插件mave-jar-plugin](https://blog.csdn.net/Ares5kong/article/details/128777500)
