# 文件位置

* 全局配置：`Maven`的安装目录的`conf`子目录下面`${M2_HOME}/conf/settings.xml`。
* 用户配置：用户目录的的`.m2`子目录下面`{user.home}/.m2/settings.xml`。当前用户的独享配置。

当我们使用一些`IDEA`工具时，可以直接指定`settings.xml`文件的位置。

# 配置文件的优先级

<font color="#f79646">局部配置高于全局配置</font>

配置优先级从高到低：`pom.xml> user settings > global settings`

>如果这些文件同时存在，在应用配置时，会合并它们的内容，如果有重复的配置，优先级高的配置会覆盖优先级低的。

# 两种仓库

在Maven中，仓库指的是存放代码构建的一个位置。从分类上来说，Maven仓库有两种类型，分别是：

- 本地仓库（Local）：是存在于本地的一个仓库，它用来缓存下载的依赖包。这样就不用每次都通过网络去拉取依赖包了，提高了依赖拉取速度，减轻了仓库服务器的压力。
- 远程仓库（Remote）：如其名字所述，其实位于远程服务器的一个仓库。例如有些公司自己对外开放了一些API，需要将这些API的依赖开放出去，这时候就可以将API的Jar包放到公司自己的远程仓库中。公司的客户可以通过连接该仓库下载Jar包。例如你们公司开发了自己的基础工具类，并将其打成了一个Jar包。此时你可以将该Jar包部署到公司自己的远程仓库中，公司其他开发伙伴配置该远程仓库，从而可以拉取到该Jar包依赖。

在网上其他资料中，还会提到Maven仓库有另一个类型 —— <font color="#f79646">中央仓库</font>（Central）。但在我看来，中央仓库其实是一个特殊的远程仓库。它的特殊之处在于，它是Maven官方提供的，其中包括了大量常用的库，基本上大多数的依赖包都可以在这里找到。另外一个特殊之处在于，<font color="#f79646">中央仓库的地址是内置在Maven源码中的，即默认会向中央仓库拉取依赖</font>，这个在后续的依赖搜索顺序中会讲到。

而我们经常说的<font color="#f79646">私服</font>，其实也是一个特殊的远程仓库，其特殊之处在于：它只对公司内部开放，方便存放一些本团队创建的开发库。我们经常说的阿里云Maven库，其实就是一个远程仓库，只不过其是对所有人开放罢了。

![[Pasted image 20240228181816.png|400]]

# 依赖搜索顺序

按照以下顺序查找依赖库：

1. 首先，在本地仓库搜索，如果找不到则继续下一步。
2. 接着，在中央仓库搜索，如果找不到则继续下一步。
3. 最后，在远程仓库中搜索，如果找不到则抛出错误。如果没有设置远程仓库，那么抛出错误。如果找到了依赖，那么就下载到本地仓库缓存。

简单地说，Maven搜索遵循简单的顺序 —— <font color="#f79646">本地仓库 → 中央仓库 → 远程仓库</font>。弄明白了这个依赖搜索顺序，可以帮助我们更好地排查问题。但这可能还不够，我们还需要搞清楚Maven的setting.xml中的一些配置信息，从而可以排查是否是配置出现了问题。例如：有时候我们配置了mirror镜像，会把对某个仓库的请求转发到另一个仓库，这时候你要是不懂mirror配置，你就找不到问题所在了。

# settings.xml内容说明

## repositories

repositories标签用于定义远程仓库，既可以在settings.xml文件中配置，也可以在pom.xml中配置。Maven在拉取依赖的时候，是<font color="#f79646">按照声明的顺序从上到下</font>去对应的远程仓库拉取依赖的。

## mirrors

mirror标签用于定义仓库镜像，其相当于一个<font color="#f79646">拦截器</font>。当mirror的mirrorOf值与repository的id相同时，repository定义的仓库会被拦截，转而使用mirror中定义的仓库地址。

```xml
<!--使用xx公司私有仓库替换Maven默认的中央仓库 -->
<mirrors>
    <mirror>
        <!--自己公司的镜像的唯一标识,在mirror标签中，其实没啥用：如xiaoyaziyun -->
        <id>xiaoyaziyun</id>   
        <!--仓库描述，随意写 -->
        <name>xx公司私有仓库地址</name> 
        <!--xx公司私有仓库地址，这个很重要不能错-->
        <url>http://maven.aliyun.com/nexus/content/groups/public/</url>
        <!--central为Maven中央仓库的标识，替换Maven源码内默认的是中央仓库地址-->
        <mirrorOf>central</mirrorOf>
    </mirror>
</mirrors>
```

如上图配置所示，Maven会用`http://maven.aliyun.com/nexus/content/groups/public/`这个仓库镜像替换Maven中央仓库，<font color="#f79646">其中central是Maven中央仓库的ID标识</font>。我们经常说用阿里云的Maven仓库可以提速，其实就是使用这种方法实现的。

## servers

大部分远程仓库无须认证就可以访问，但我们自己搭建的Maven仓库，<font color="#f79646">出于安全方面的考虑</font>，我们会设置访问权限。此时，我们需要在setting.xml文件中配置server标签。配置示例如下代码所示：

```xml
<settings>
    <!--配置远程仓库认证信息-->
     <servers>
        <server>
             <id>shuyi-tech-repo</id>
             <username>admin</username>
             <password>admin123</password>
         </server>
     </servers>
</settings>
```

上面的配置为repository.id为`shuyi-tech-repo`的远程仓库配置了用户名和密码，其中用户名为`admin`，密码为`admin123`。<font color="#f79646">这里通过server.id与reposiroty.id标签将认证信息与仓库绑定在一起</font>，因此在配置的时候需要保持这两个信息一致，否则可能导致访问失败。

## pluginGroups


## proxies

服务器不能直接访问外网时需要设置的代理服务，不常用。

## profiles

上面提到mirror，配置多个只会一个有效，如果需要多仓库配置，可以在profiles节点下配置多个profile，但是配置需要激活，特别麻烦，也不常用。


# 总结



# 资料

* [一文带你弄懂Maven拉包原理](https://juejin.cn/post/7218128044666372154)


