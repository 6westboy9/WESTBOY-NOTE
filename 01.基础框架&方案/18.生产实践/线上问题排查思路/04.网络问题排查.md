# 基础

![[Pasted image 20250625172251.png|L|300]]

# 实战

## 查看所有端口

```sh
# netstat -ant | awk '/^tcp/ {split($4,a,":"); print a[length(a)] " " $6}' | sort | uniq -c | sort -nr | head -20
204 10393 TIME_WAIT
 95 10383 TIME_WAIT
 88 6379 ESTABLISHED
 51 443 ESTABLISHED
 48 5672 ESTABLISHED
 43 10480 TIME_WAIT
 37 10580 ESTABLISHED
 35 22 ESTABLISHED
 27 2181 ESTABLISHED
 25 20981 ESTABLISHED
 22 86 ESTABLISHED
 20 20583 ESTABLISHED
 18 9000 ESTABLISHED
 16 8600 ESTABLISHED
 16 20885 ESTABLISHED
 14 9099 TIME_WAIT
 12 20883 ESTABLISHED
 11 86 FIN_WAIT2
 11 10580 TIME_WAIT
 10 443 TIME_WAIT
```

## 查看指定端口的连接状态及其数量

比如：查看SpringBoot中Tomcat连接数状态

```sh
# netstat -ant | awk '$4 ~ /:9099$/ {split($4,a,":"); print a[length(a)] " " $6}' | sort | uniq -c | sort -nr
 14 9099 TIME_WAIT
  3 9099 ESTABLISHED
  1 9099 LISTEN
```

>那SpringBoot中Tomcat的最大连接数是多少呢？

* 默认maxConnections是8192/10000（Tomcat版本不同版本有差异），但受操作系统和硬件资源限制
* 最大连接数修改方式：`server.tomcat.max-connections=2000`
* 对应的配置属性：`org.springframework.boot.autoconfigure.web.ServerProperties.Tomcat#maxConnections`

>如何查看SprintBoot+Tomcat配置的最大连接数呢？

这里借助Arthas工具。

```sh
# 第1步
# sc -d org.springframework.boot.autoconfigure.web.ServerProperties$Tomcat
 class-info        org.springframework.boot.autoconfigure.web.ServerProperties$Tomcat                                                                          
 code-source       file:/usr/local/springboot/kkFileView/kkFileView-4.4.0-beta/bin/kkFileView-4.4.0-beta.jar!/BOOT-INF/lib/spring-boot-autoconfigure-2.4.2.jar!/
 name              org.springframework.boot.autoconfigure.web.ServerProperties$Tomcat
 isInterface       false
 isAnnotation      false  
 isEnum            false
 isAnonymousClass  false
 isArray           false
 isLocalClass      false
 isMemberClass     true
 isPrimitive       false
 isSynthetic       false
 simple-name       Tomcat
 modifier          public,static
 annotation
 interfaces
 super-class       +-java.lang.Object
 class-loader      +-org.springframework.boot.loader.LaunchedURLClassLoader@238e0d81
                     +-sun.misc.Launcher$AppClassLoader@42a57993
                       +-sun.misc.Launcher$ExtClassLoader@4470f8a6
 classLoaderHash   238e0d81
```

```sh
# 第2步
# vmtool -x 3 --action getInstances --className org.springframework.boot.autoconfigure.web.ServerProperties$Tomcat  --express 'instances[0].getMaxConnections()'  -c 238e0d81
@Integer[8192]
```

