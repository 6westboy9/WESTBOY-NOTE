

* 怎么做到只指定一个-javaagent参数？
* 怎么做到加载多个plugin？
* 怎么将TypeDescription和需要拦截的方法对应起来？
* 怎么把TypeDescription和需要拦截的方法的拦截器对应起来？


==需求==

>可插拔式插件~

>TypeDescription可以认为用于描述和操作类的元数据信息~

简单想法

```java
DynamicType.Builder.MethodDefinition.ReceiverTypeDefinition<?> intercept = builder
	.method(
		not(isStatic()).and(isAnnotatedWith(nameStartsWith("org.springframework.web.bind.annotation").and(nameEndsWith("Mapping"))))
		.or(named("execute").or(named("executeUpdate")).or(named("executeQuery")))
	)
	.intercept(MethodDelegation.to(new SpringMvcInterceptor())
		.andThen(MethodDelegation.to(new MySQLInterceptor())));
```

* 在SpringMvcInterceptor拦截器中期望只是对于org.springframework.web.bind.annotation包下的@XxxMapping注解的所有方法进行拦截。
* 在MySQLlInterceptor需要对execute、executeUpdate、executeQuery方法进行拦截。

==存在问题==

* 万一某个业务代码下有execute/executeUpdate/executeQuery方法，那岂不是误拦截了，因为并非MySQL所期望的。拦截的并非拦截器期望的方法，<font color="#f79646">如何将拦截的方法对应起来？</font>
* 拦截的方法有可能被其它拦截器误处理，<font color="#f79646">如何把需要拦截的方法与拦截器对应起来？</font>


就算是MySQL，是不是也会存在A方法需要MySQL拦截器A，B方法需要MySQL拦截器B？需要灵活定制~


流程上：

1. 先找到增强类
2. 再找到拦截器方法
3. 再定制该拦截方法的拦截器


多个类名匹配的使用场景


# 踩坑

1.builder是不可变的，在操作之后，需要重新赋值给builder，否则不会生效~

# 遗留


![[Pasted image 20231107172854.png|1100]]

